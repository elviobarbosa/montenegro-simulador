/*! For license information please see terreno-admin.bundle.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function n(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach(function(t){o(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,r(o.key),o)}}function r(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var i=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state={map:null,drawingManager:null,polygons:new Map,lotesData:[],isDrawingMode:!1,currentMapType:"roadmap",currentPolygon:null,currentInfoWindow:null,currentEditLoteId:null,zoom:18,center:{lat:-3.7319,lng:-38.5267}},this.subscribers=new Map},(t=[{key:"setState",value:function(e,t){var n=this.state[e];this.state[e]=t,n!==t&&this.notifySubscribers(e,t,n)}},{key:"getState",value:function(e){return this.state[e]}},{key:"getAllState",value:function(){return n({},this.state)}},{key:"subscribe",value:function(e,t){this.subscribers.has(e)||this.subscribers.set(e,[]),this.subscribers.get(e).push(t)}},{key:"unsubscribe",value:function(e,t){if(this.subscribers.has(e)){var n=this.subscribers.get(e),o=n.indexOf(t);o>-1&&n.splice(o,1)}}},{key:"notifySubscribers",value:function(e,t,n){this.subscribers.has(e)&&this.subscribers.get(e).forEach(function(o){try{o(t,n)}catch(t){console.error('Erro ao executar subscriber da chave "'.concat(e,'":'),t)}})}},{key:"setMultiple",value:function(e){var t=this;Object.keys(e).forEach(function(n){t.setState(n,e[n])})}},{key:"reset",value:function(){this.state={map:null,drawingManager:null,polygons:new Map,lotesData:[],isDrawingMode:!1,currentMapType:"roadmap",currentPolygon:null,currentInfoWindow:null,currentEditLoteId:null,zoom:18,center:{lat:-3.7319,lng:-38.5267}}}},{key:"addPolygon",value:function(e,t){this.state.polygons.set(e,t)}},{key:"removePolygon",value:function(e){this.state.polygons.delete(e)}},{key:"getPolygon",value:function(e){return this.state.polygons.get(e)}},{key:"addLote",value:function(e){this.state.lotesData.push(e)}},{key:"updateLote",value:function(e,t){var o=this.state.lotesData.findIndex(function(t){return t.id===e});o>-1&&(this.state.lotesData[o]=n(n({},this.state.lotesData[o]),t))}},{key:"removeLote",value:function(e){this.state.lotesData=this.state.lotesData.filter(function(t){return t.id!==e})}},{key:"getLote",value:function(e){return this.state.lotesData.find(function(t){return t.id===e})}}])&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,u(o.key),o)}}function u(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}var c=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events=new Map},t=[{key:"on",value:function(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}},{key:"off",value:function(e,t){if(this.events.has(e)){var n=this.events.get(e),o=n.indexOf(t);o>-1&&n.splice(o,1),0===n.length&&this.events.delete(e)}}},{key:"emit",value:function(e,t){this.events.has(e)&&this.events.get(e).forEach(function(n){try{n(t)}catch(t){console.error('Erro ao executar callback do evento "'.concat(e,'":'),t)}})}},{key:"once",value:function(e,t){var n=this,o=function(a){t(a),n.off(e,o)};this.on(e,o)}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?this.events.delete(e):this.events.clear()}},{key:"listenerCount",value:function(e){return this.events.has(e)?this.events.get(e).length:0}}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function v(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function r(n,o,a,r){var l=o&&o.prototype instanceof s?o:s,u=Object.create(l.prototype);return g(u,"_invoke",function(n,o,a){var r,s,l,u=0,c=a||[],d=!1,v={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return r=t,s=0,l=e,v.n=n,i}};function g(n,o){for(s=n,l=o,t=0;!d&&u&&!a&&t<c.length;t++){var a,r=c[t],g=v.p,p=r[2];n>3?(a=p===o)&&(l=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=g&&((a=n<2&&g<r[1])?(s=0,v.v=o,v.n=r[1]):g<p&&(a=n<3||r[0]>o||o>p)&&(r[4]=n,r[5]=o,v.n=p,s=0))}if(a||n>1)return i;throw d=!0,o}return function(a,c,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&g(c,p),s=c,l=p;(t=s<2?e:l)||!d;){r||(s?s<3?(s>1&&(v.n=-1),g(s,l)):v.n=l:v.v=l);try{if(u=2,r){if(s||(a="next"),t=r[a]){if(!(t=t.call(r,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=r.return)&&t.call(r),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);r=e}else if((t=(d=v.n<0)?l:n.call(o,v))!==i)break}catch(t){r=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,a,r),!0),u}var i={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][o]?t(t([][o]())):(g(t={},o,function(){return this}),t),d=u.prototype=s.prototype=Object.create(c);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,g(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,g(d,"constructor",u),g(u,"constructor",l),l.displayName="GeneratorFunction",g(u,a,"GeneratorFunction"),g(d),g(d,a,"Generator"),g(d,o,function(){return this}),g(d,"toString",function(){return"[object Generator]"}),(v=function(){return{w:r,m:p}})()}function g(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}g=function(e,t,n,o){function r(t,n){g(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))},g(e,t,n,o)}function p(e,t,n,o,a,r,i){try{var s=e[r](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,y(o.key),o)}}function y(e){var t=function(e){if("object"!=d(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==d(t)?t:t+""}var m=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elementId=t,this.stateManager=n,this.eventBus=o,this.map=null,this.geocoder=null},t=[{key:"initialize",value:(n=v().m(function e(t,n,o){var a,r;return v().w(function(e){for(;;)switch(e.n){case 0:if(a=document.getElementById(this.elementId)){e.n=1;break}throw new Error('Elemento com ID "'.concat(this.elementId,'" não encontrado'));case 1:if("undefined"!=typeof google&&void 0!==google.maps){e.n=2;break}throw new Error("Google Maps API não está carregada");case 2:return r={center:{lat:t,lng:n},zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0,zoomControl:!0,gestureHandling:"greedy"},this.map=new google.maps.Map(a,r),this.geocoder=new google.maps.Geocoder,this.stateManager.setState("map",this.map),this.stateManager.setMultiple({center:{lat:t,lng:n},zoom:o,currentMapType:"roadmap"}),this.setupMapEventListeners(),this.eventBus.emit("map:initialized",{lat:t,lng:n,zoom:o}),e.a(2,this.map)}},e,this)}),o=function(){var e=this,t=arguments;return new Promise(function(o,a){var r=n.apply(e,t);function i(e){p(r,o,a,i,s,"next",e)}function s(e){p(r,o,a,i,s,"throw",e)}i(void 0)})},function(e,t,n){return o.apply(this,arguments)})},{key:"setupMapEventListeners",value:function(){var e=this;google.maps.event.addListener(this.map,"zoom_changed",function(){var t=e.map.getZoom();e.stateManager.setState("zoom",t),e.eventBus.emit("map:zoom_changed",t)}),google.maps.event.addListener(this.map,"center_changed",function(){var t=e.map.getCenter(),n={lat:t.lat(),lng:t.lng()};e.stateManager.setState("center",n)}),google.maps.event.addListener(this.map,"click",function(){e.eventBus.emit("map:clicked")})}},{key:"getMap",value:function(){return this.map}},{key:"getGeocoder",value:function(){return this.geocoder}},{key:"updateCenter",value:function(e,t){if(this.map){var n=new google.maps.LatLng(e,t);this.map.setCenter(n),this.stateManager.setState("center",{lat:e,lng:t}),this.eventBus.emit("map:center_updated",{lat:e,lng:t})}else console.warn("Mapa não inicializado")}},{key:"updateZoom",value:function(e){if(this.map){var t=Math.max(1,Math.min(20,e));this.map.setZoom(t),this.stateManager.setState("zoom",t)}else console.warn("Mapa não inicializado")}},{key:"toggleMapType",value:function(){if(this.map){var e="roadmap"===this.stateManager.getState("currentMapType")?"satellite":"roadmap";return this.map.setMapTypeId("satellite"===e?google.maps.MapTypeId.SATELLITE:google.maps.MapTypeId.ROADMAP),this.stateManager.setState("currentMapType",e),this.eventBus.emit("map:type_changed",e),e}console.warn("Mapa não inicializado")}},{key:"fitBounds",value:function(e){if(this.map&&e&&0!==e.length){var t=new google.maps.LatLngBounds;e.forEach(function(e){e.getPath().forEach(function(e){t.extend(e)})}),this.map.fitBounds(t)}}},{key:"fitToBounds",value:function(e){this.map&&this.map.fitBounds(e)}},{key:"panTo",value:function(e,t){if(this.map){var n=new google.maps.LatLng(e,t);this.map.panTo(n)}}},{key:"clearOverlays",value:function(){this.eventBus.emit("map:overlays_cleared")}},{key:"destroy",value:function(){this.map&&(google.maps.event.clearInstanceListeners(this.map),this.map=null,this.geocoder=null,this.stateManager.setState("map",null),this.eventBus.emit("map:destroyed"))}}],t&&h(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,w(o.key),o)}}function w(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}var E=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.stateManager=n,this.eventBus=o,this.drawingManager=null,this.currentPolygon=null},(t=[{key:"initialize",value:function(){var e=this;this.drawingManager||(this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,polygonOptions:{strokeColor:"#FF6B6B",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF6B6B",fillOpacity:.35,editable:!0,draggable:!1}}),this.drawingManager.setMap(this.map),this.stateManager.setState("drawingManager",this.drawingManager),google.maps.event.addListener(this.drawingManager,"overlaycomplete",function(t){t.type===google.maps.drawing.OverlayType.POLYGON&&e.handlePolygonComplete(t.overlay)}),console.log("DrawingManager inicializado"))}},{key:"startDrawing",value:function(){this.drawingManager||this.initialize(),this.currentPolygon&&this.cancelDrawing(),this.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),this.stateManager.setState("isDrawingMode",!0),this.eventBus.emit("drawing:started"),console.log("Modo de desenho ativado")}},{key:"stopDrawing",value:function(){if(!this.drawingManager)return null;this.drawingManager.setDrawingMode(null),this.stateManager.setState("isDrawingMode",!1);var e=this.currentPolygon;return this.currentPolygon=null,this.eventBus.emit("drawing:stopped",{polygon:e}),console.log("Modo de desenho desativado"),e}},{key:"cancelDrawing",value:function(){this.currentPolygon&&(this.currentPolygon.setMap(null),this.currentPolygon=null),this.drawingManager&&this.drawingManager.setDrawingMode(null),this.stateManager.setState("isDrawingMode",!1),this.stateManager.setState("currentPolygon",null),this.eventBus.emit("drawing:canceled"),console.log("Desenho cancelado")}},{key:"handlePolygonComplete",value:function(e){if(this.drawingManager.setDrawingMode(null),!this.validatePolygon(e))return e.setMap(null),void this.eventBus.emit("drawing:invalid");this.currentPolygon=e,this.stateManager.setState("currentPolygon",e);var t=this.extractCoordinates(e);this.eventBus.emit("drawing:completed",{polygon:e,coordinates:t}),console.log("Polígono desenhado com sucesso",{vertices:t.length})}},{key:"validatePolygon",value:function(e){return!(e.getPath().getLength()<3&&(alert("O polígono deve ter pelo menos 3 vértices"),1))}},{key:"extractCoordinates",value:function(e){for(var t=e.getPath(),n=[],o=0;o<t.getLength();o++){var a=t.getAt(o);n.push({lat:a.lat(),lng:a.lng()})}return n}},{key:"getCurrentPolygon",value:function(){return this.currentPolygon}},{key:"isDrawing",value:function(){return this.stateManager.getState("isDrawingMode")}},{key:"setPolygonOptions",value:function(e){this.drawingManager&&this.drawingManager.setOptions({polygonOptions:e})}},{key:"destroy",value:function(){this.currentPolygon&&(this.currentPolygon.setMap(null),this.currentPolygon=null),this.drawingManager&&(google.maps.event.clearInstanceListeners(this.drawingManager),this.drawingManager.setMap(null),this.drawingManager=null),this.stateManager.setState("drawingManager",null),this.stateManager.setState("isDrawingMode",!1),this.stateManager.setState("currentPolygon",null),console.log("DrawingManager destruído")}}])&&b(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function k(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,x(o.key),o)}}function x(e){var t=function(e){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:t+""}var L=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.stateManager=n,this.eventBus=o},(t=[{key:"createPolygon",value:function(e){if(!e.coordinates||e.coordinates.length<3)return console.error("Lote deve ter no mínimo 3 coordenadas"),null;var t=e.coordinates.map(function(e){return{lat:e.lat,lng:e.lng}}),n=e.color||this.generateRandomColor(),o=new google.maps.Polygon({paths:t,strokeColor:n,strokeOpacity:.8,strokeWeight:2,fillColor:n,fillOpacity:.35,editable:!1,draggable:!1,map:this.map});return o.loteId=e.id,o.loteData=e,this.stateManager.addPolygon(e.id,o),this.setupPolygonEvents(o,e),o}},{key:"setupPolygonEvents",value:function(e,t){var n=this;google.maps.event.addListener(e,"click",function(o){n.eventBus.emit("polygon:clicked",{lote:t,polygon:e,event:o})}),google.maps.event.addListener(e,"mouseover",function(){e.setOptions({strokeWeight:3,fillOpacity:.5}),n.eventBus.emit("polygon:hover",{lote:t,polygon:e})}),google.maps.event.addListener(e,"mouseout",function(){e.setOptions({strokeWeight:2,fillOpacity:.35})}),google.maps.event.addListener(e,"rightclick",function(o){n.eventBus.emit("polygon:rightclick",{lote:t,polygon:e,event:o})})}},{key:"updatePolygon",value:function(e,t){var n=this.stateManager.getPolygon(e);if(!n)return console.warn('Polígono com ID "'.concat(e,'" não encontrado')),!1;var o=t.map(function(e){return{lat:e.lat,lng:e.lng}});return n.setPath(o),this.eventBus.emit("polygon:updated",{loteId:e,coordinates:t}),!0}},{key:"enableEditing",value:function(e){var t=this,n=this.stateManager.getPolygon(e);if(n){n.setOptions({editable:!0,draggable:!0});var o=google.maps.event.addListener(n.getPath(),"set_at",function(){t.handlePolygonEdit(n)}),a=google.maps.event.addListener(n.getPath(),"insert_at",function(){t.handlePolygonEdit(n)});n.editListeners=[o,a]}else console.warn('Polígono com ID "'.concat(e,'" não encontrado'))}},{key:"disableEditing",value:function(e){var t=this.stateManager.getPolygon(e);t&&(t.setOptions({editable:!1,draggable:!1}),t.editListeners&&(t.editListeners.forEach(function(e){google.maps.event.removeListener(e)}),t.editListeners=null))}},{key:"handlePolygonEdit",value:function(e){for(var t=e.getPath(),n=[],o=0;o<t.getLength();o++){var a=t.getAt(o);n.push({lat:a.lat(),lng:a.lng()})}this.eventBus.emit("polygon:path_changed",{loteId:e.loteId,coordinates:n})}},{key:"deletePolygon",value:function(e){var t=this.stateManager.getPolygon(e);return t?(t.editListeners&&t.editListeners.forEach(function(e){google.maps.event.removeListener(e)}),google.maps.event.clearInstanceListeners(t),t.setMap(null),this.stateManager.removePolygon(e),this.eventBus.emit("polygon:deleted",{loteId:e}),!0):(console.warn('Polígono com ID "'.concat(e,'" não encontrado')),!1)}},{key:"loadPolygons",value:function(e){var t=this,n=[];return e.forEach(function(e){var o=t.createPolygon(e);o&&n.push(o)}),console.log("".concat(n.length," polígono(s) carregado(s) no mapa")),this.eventBus.emit("polygons:loaded",n),n}},{key:"clearAllPolygons",value:function(){var e=this.stateManager.getState("polygons");e.forEach(function(e,t){google.maps.event.clearInstanceListeners(e),e.setMap(null)}),e.clear(),this.eventBus.emit("polygons:cleared"),console.log("Todos os polígonos foram removidos")}},{key:"highlightPolygon",value:function(e){var t=this.stateManager.getPolygon(e);if(t){var n={strokeWeight:t.strokeWeight,strokeOpacity:t.strokeOpacity,fillOpacity:t.fillOpacity};t.setOptions({strokeWeight:4,strokeOpacity:1,fillOpacity:.6}),setTimeout(function(){t.setOptions(n)},2e3)}}},{key:"generateRandomColor",value:function(){var e=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F06292","#AED581","#FFD54F","#4DB6AC","#7986CB"];return e[Math.floor(Math.random()*e.length)]}},{key:"getAllPolygons",value:function(){return this.stateManager.getState("polygons")}},{key:"centerOnPolygon",value:function(e){var t=this.stateManager.getPolygon(e);if(t){var n=new google.maps.LatLngBounds;t.getPath().forEach(function(e){n.extend(e)}),this.map.fitBounds(n),this.map.setZoom(Math.min(this.map.getZoom(),18))}}}])&&k(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){I(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function I(e,t,n){return(t=T(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function r(n,o,a,r){var l=o&&o.prototype instanceof s?o:s,u=Object.create(l.prototype);return C(u,"_invoke",function(n,o,a){var r,s,l,u=0,c=a||[],d=!1,v={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return r=t,s=0,l=e,v.n=n,i}};function g(n,o){for(s=n,l=o,t=0;!d&&u&&!a&&t<c.length;t++){var a,r=c[t],g=v.p,p=r[2];n>3?(a=p===o)&&(l=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=g&&((a=n<2&&g<r[1])?(s=0,v.v=o,v.n=r[1]):g<p&&(a=n<3||r[0]>o||o>p)&&(r[4]=n,r[5]=o,v.n=p,s=0))}if(a||n>1)return i;throw d=!0,o}return function(a,c,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&g(c,p),s=c,l=p;(t=s<2?e:l)||!d;){r||(s?s<3?(s>1&&(v.n=-1),g(s,l)):v.n=l:v.v=l);try{if(u=2,r){if(s||(a="next"),t=r[a]){if(!(t=t.call(r,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=r.return)&&t.call(r),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);r=e}else if((t=(d=v.n<0)?l:n.call(o,v))!==i)break}catch(t){r=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,a,r),!0),u}var i={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][o]?t(t([][o]())):(C(t={},o,function(){return this}),t),d=u.prototype=s.prototype=Object.create(c);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,C(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,C(d,"constructor",u),C(u,"constructor",l),l.displayName="GeneratorFunction",C(u,a,"GeneratorFunction"),C(d),C(d,a,"Generator"),C(d,o,function(){return this}),C(d,"toString",function(){return"[object Generator]"}),(B=function(){return{w:r,m:v}})()}function C(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}C=function(e,t,n,o){function r(t,n){C(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))},C(e,t,n,o)}function _(e,t,n,o,a,r,i){try{var s=e[r](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}function j(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var r=e.apply(t,n);function i(e){_(r,o,a,i,s,"next",e)}function s(e){_(r,o,a,i,s,"throw",e)}i(void 0)})}}function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,T(o.key),o)}}function T(e){var t=function(e){if("object"!=M(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==M(t)?t:t+""}var A=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geocoder=t,this.eventBus=n},t=[{key:"searchAddress",value:(s=j(B().m(function e(t){var n=this;return B().w(function(e){for(;;)switch(e.n){case 0:if(t&&""!==t.trim()){e.n=1;break}throw new Error("Endereço não pode ser vazio");case 1:return e.a(2,new Promise(function(e,o){n.geocoder.geocode({address:t},function(a,r){if(r===google.maps.GeocoderStatus.OK&&a[0]){var i=a[0].geometry.location,s={lat:i.lat(),lng:i.lng(),formatted_address:a[0].formatted_address,place_id:a[0].place_id};n.eventBus.emit("geocode:success",s),console.log("Endereço encontrado:",s.formatted_address),e(s)}else{var l=new Error("Geocode falhou: ".concat(r));n.eventBus.emit("geocode:error",{address:t,status:r}),console.error("Erro ao buscar endereço:",r),o(l)}})}))}},e)})),function(e){return s.apply(this,arguments)})},{key:"reverseGeocode",value:(i=j(B().m(function e(t,n){var o,a=this;return B().w(function(e){for(;;)if(0===e.n)return o=new google.maps.LatLng(t,n),e.a(2,new Promise(function(e,r){a.geocoder.geocode({location:o},function(o,i){if(i===google.maps.GeocoderStatus.OK&&o[0]){var s=o[0].formatted_address;a.eventBus.emit("reverse_geocode:success",{lat:t,lng:n,address:s}),console.log("Endereço encontrado:",s),e(s)}else{var l=new Error("Reverse geocode falhou: ".concat(i));a.eventBus.emit("reverse_geocode:error",{lat:t,lng:n,status:i}),r(l)}})}))},e)})),function(e,t){return i.apply(this,arguments)})},{key:"searchCoordinates",value:(r=j(B().m(function e(t){var n,o,a,r;return B().w(function(e){for(;;)switch(e.n){case 0:if(2===(n=t.split(",").map(function(e){return e.trim()})).length){e.n=1;break}throw new Error("Formato inválido. Use: latitude, longitude");case 1:if(o=parseFloat(n[0]),a=parseFloat(n[1]),!isNaN(o)&&!isNaN(a)){e.n=2;break}throw new Error("Coordenadas inválidas");case 2:if(!(o<-90||o>90||a<-180||a>180)){e.n=3;break}throw new Error("Coordenadas fora dos limites válidos");case 3:return r={lat:o,lng:a},this.eventBus.emit("coordinates:searched",r),console.log("Coordenadas processadas:",r),e.a(2,r)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getCurrentLocation",value:(a=j(B().m(function e(){var t=this;return B().w(function(e){for(;;)switch(e.n){case 0:if(navigator.geolocation){e.n=1;break}throw new Error("Geolocalização não é suportada por este navegador");case 1:return e.a(2,new Promise(function(e,n){navigator.geolocation.getCurrentPosition(function(n){var o={lat:n.coords.latitude,lng:n.coords.longitude,accuracy:n.coords.accuracy};t.eventBus.emit("geolocation:success",o),console.log("Localização atual obtida:",o),e(o)},function(e){var o="Erro ao obter localização";switch(e.code){case e.PERMISSION_DENIED:o="Permissão de localização negada";break;case e.POSITION_UNAVAILABLE:o="Localização indisponível";break;case e.TIMEOUT:o="Timeout ao obter localização"}t.eventBus.emit("geolocation:error",{code:e.code,message:o}),console.error(o,e),n(new Error(o))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}))}},e)})),function(){return a.apply(this,arguments)})},{key:"getPlaceDetails",value:(o=j(B().m(function e(t){var n=this;return B().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,o){n.geocoder.geocode({placeId:t},function(a,r){if(r===google.maps.GeocoderStatus.OK&&a[0]){var i=a[0].geometry.location,s={lat:i.lat(),lng:i.lng(),formatted_address:a[0].formatted_address,place_id:a[0].place_id,types:a[0].types};n.eventBus.emit("place_details:success",s),e(s)}else{var l=new Error("Place details falhou: ".concat(r));n.eventBus.emit("place_details:error",{placeId:t,status:r}),o(l)}})}))},e)})),function(e){return o.apply(this,arguments)})},{key:"validateInput",value:function(e){return e&&""!==e.trim()?(e=e.trim(),/^-?\d+\.?\d*\s*,\s*-?\d+\.?\d*$/.test(e)?{type:"coordinates",valid:!0}:{type:"address",valid:!0}):{type:null,valid:!1}}},{key:"smartSearch",value:(n=j(B().m(function e(t){var n,o,a,r;return B().w(function(e){for(;;)switch(e.n){case 0:if((n=this.validateInput(t)).valid){e.n=1;break}throw new Error("Entrada inválida");case 1:if("coordinates"!==n.type){e.n=4;break}return e.n=2,this.searchCoordinates(t);case 2:return o=e.v,e.n=3,this.reverseGeocode(o.lat,o.lng);case 3:return a=e.v,e.a(2,P(P({},o),{},{address:a}));case 4:return e.n=5,this.searchAddress(t);case 5:return r=e.v,e.a(2,{lat:r.lat,lng:r.lng,address:r.formatted_address});case 6:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})}],t&&D(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,a,r,i,s}();function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function F(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,N(o.key),o)}}function N(e){var t=function(e){if("object"!=R(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=R(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==R(t)?t:t+""}var V=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fieldId=t,this.stateManager=n,this.eventBus=o,this.field=null},(t=[{key:"initialize",value:function(){return this.field=document.getElementById(this.fieldId),!!this.field||(console.error('Campo hidden com ID "'.concat(this.fieldId,'" não encontrado')),!1)}},{key:"load",value:function(){var e=this;if(!this.initialize())return[];var t=this.field.value;if(!t||""===t.trim())return console.log("Nenhum dado de lotes encontrado"),[];try{var n=JSON.parse(t);if(!Array.isArray(n))return console.error("Dados de lotes inválidos: esperado array"),[];var o=n.filter(function(t){return e.validateLote(t)});return this.stateManager.setState("lotesData",o),console.log("".concat(o.length," lote(s) carregado(s)")),this.eventBus.emit("data:loaded",o),o}catch(e){return console.error("Erro ao fazer parse dos dados de lotes:",e),console.error("Dados problemáticos:",t.substring(0,200)),[]}}},{key:"save",value:function(){if(!this.initialize())return!1;var e=this.stateManager.getState("lotesData");try{var t=JSON.stringify(e);return this.field.value=t,console.log("".concat(e.length," lote(s) salvo(s)")),this.eventBus.emit("data:saved",e),!0}catch(e){return console.error("Erro ao serializar dados de lotes:",e),!1}}},{key:"validateLote",value:function(e){if(!e||"object"!==R(e))return console.warn("Lote inválido: não é um objeto",e),!1;for(var t=0,n=["id","coordinates"];t<n.length;t++){var o=n[t];if(!(o in e))return console.warn('Lote inválido: campo "'.concat(o,'" ausente'),e),!1}if(!Array.isArray(e.coordinates)||e.coordinates.length<3)return console.warn("Lote inválido: coordinates deve ser array com no mínimo 3 pontos",e),!1;var a,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return z(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,r=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw r}}}}(e.coordinates);try{for(r.s();!(a=r.n()).done;){var i=a.value;if("number"!=typeof i.lat||"number"!=typeof i.lng)return console.warn("Lote inválido: coordenada com lat/lng inválido",i),!1}}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"addLote",value:function(e){return this.validateLote(e)?(this.stateManager.addLote(e),this.save()):(console.error("Lote inválido, não será adicionado"),!1)}},{key:"updateLote",value:function(e,t){return this.stateManager.updateLote(e,t),this.save()}},{key:"removeLote",value:function(e){return this.stateManager.removeLote(e),this.save()}},{key:"clearAll",value:function(){return this.stateManager.setState("lotesData",[]),this.save()}},{key:"exportJSON",value:function(){var e=this.stateManager.getState("lotesData");return JSON.stringify(e,null,2)}},{key:"importJSON",value:function(e){var t=this;try{var n=JSON.parse(e);if(!Array.isArray(n))throw new Error("Dados devem ser um array");var o=n.filter(function(e){return t.validateLote(e)});return this.stateManager.setState("lotesData",o),this.save()}catch(e){return console.error("Erro ao importar JSON:",e),!1}}}])&&F(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function H(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(H=function(){return!!e})()}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function U(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function r(n,o,a,r){var l=o&&o.prototype instanceof s?o:s,u=Object.create(l.prototype);return J(u,"_invoke",function(n,o,a){var r,s,l,u=0,c=a||[],d=!1,v={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return r=t,s=0,l=e,v.n=n,i}};function g(n,o){for(s=n,l=o,t=0;!d&&u&&!a&&t<c.length;t++){var a,r=c[t],g=v.p,p=r[2];n>3?(a=p===o)&&(l=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=g&&((a=n<2&&g<r[1])?(s=0,v.v=o,v.n=r[1]):g<p&&(a=n<3||r[0]>o||o>p)&&(r[4]=n,r[5]=o,v.n=p,s=0))}if(a||n>1)return i;throw d=!0,o}return function(a,c,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&g(c,p),s=c,l=p;(t=s<2?e:l)||!d;){r||(s?s<3?(s>1&&(v.n=-1),g(s,l)):v.n=l:v.v=l);try{if(u=2,r){if(s||(a="next"),t=r[a]){if(!(t=t.call(r,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=r.return)&&t.call(r),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);r=e}else if((t=(d=v.n<0)?l:n.call(o,v))!==i)break}catch(t){r=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,a,r),!0),u}var i={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][o]?t(t([][o]())):(J(t={},o,function(){return this}),t),d=u.prototype=s.prototype=Object.create(c);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,J(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,J(d,"constructor",u),J(u,"constructor",l),l.displayName="GeneratorFunction",J(u,a,"GeneratorFunction"),J(d),J(d,a,"Generator"),J(d,o,function(){return this}),J(d,"toString",function(){return"[object Generator]"}),(U=function(){return{w:r,m:v}})()}function J(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}J=function(e,t,n,o){function r(t,n){J(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))},J(e,t,n,o)}function Z(e,t,n,o,a,r,i){try{var s=e[r](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}function Y(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var r=e.apply(t,n);function i(e){Z(r,o,a,i,s,"next",e)}function s(e){Z(r,o,a,i,s,"throw",e)}i(void 0)})}}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,K(o.key),o)}}function $(e,t,n){return t&&Q(e.prototype,t),n&&Q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function K(e){var t=function(e){if("object"!=G(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==G(t)?t:t+""}var ee=function(){return $(function e(t,n,o,a,r){X(this,e),this.map=t,this.stateManager=n,this.eventBus=o,this.polygonManager=a,this.dataPersistence=r,this.svgContent=null,this.svgElement=null,this.shapes=[],this.viewBox=null,this.shapeMapping={},this.overlay={bounds:null,rotation:0,scale:1,center:null,width:400,height:400},this.isDragging=!1,this.isResizing=!1,this.isRotating=!1,this.dragStart=null,this.isModalOpen=!1,this.isEditorMode=!1,this.selectedShapeIndex=null,this.modal=null,this.overlayContainer=null,this.overlayElement=null,this.customOverlay=null,this.init()},[{key:"init",value:function(){var e,t,n,o,a,r,i,s,l,u,c,d,v=this,g=document.getElementById("btn_importar_svg");g&&g.addEventListener("click",function(){return v.openModal()});var p=document.getElementById("btn_ajustar_svg");p?p.addEventListener("click",function(e){e.preventDefault(),console.log("SVGOverlayManager: ajustar posicao clicado"),v.toggleEditMode()}):setTimeout(function(){var e=document.getElementById("btn_ajustar_svg");e&&e.addEventListener("click",function(e){e.preventDefault(),v.toggleEditMode()})},500);var h=document.getElementById("btn_remover_svg");if(h&&h.addEventListener("click",function(e){e.preventDefault(),v.confirmAndRemoveSvg()}),this.modal=document.getElementById("svgImportModal"),this.modal){null===(e=document.getElementById("svgImportClose"))||void 0===e||e.addEventListener("click",function(){return v.closeModal(!0)}),null===(t=document.getElementById("svgImportCancel"))||void 0===t||t.addEventListener("click",function(){return v.closeModal(!0)}),null===(n=document.getElementById("svgSelectFile"))||void 0===n||n.addEventListener("click",function(){var e;null===(e=document.getElementById("svgFileInput"))||void 0===e||e.click()}),null===(o=document.getElementById("svgFileInput"))||void 0===o||o.addEventListener("change",function(e){e.target.files.length>0&&v.handleFileUpload(e.target.files[0])});var y=document.getElementById("svgDropZone");y&&(y.addEventListener("dragover",function(e){e.preventDefault(),y.style.borderColor="#0073aa",y.style.background="#f0f7fc"}),y.addEventListener("dragleave",function(){y.style.borderColor="#ccc",y.style.background="transparent"}),y.addEventListener("drop",function(e){e.preventDefault(),y.style.borderColor="#ccc",y.style.background="transparent",e.dataTransfer.files.length>0&&v.handleFileUpload(e.dataTransfer.files[0])})),null===(a=document.getElementById("svgRotateLeft"))||void 0===a||a.addEventListener("click",function(){v.rotateOverlay(-1)}),null===(r=document.getElementById("svgRotateRight"))||void 0===r||r.addEventListener("click",function(){v.rotateOverlay(1)}),null===(i=document.getElementById("svgZoomIn"))||void 0===i||i.addEventListener("click",function(){v.scaleOverlay(1.1)}),null===(s=document.getElementById("svgZoomOut"))||void 0===s||s.addEventListener("click",function(){v.scaleOverlay(.9)}),null===(l=document.getElementById("svgResetTransform"))||void 0===l||l.addEventListener("click",function(){v.resetTransform()}),null===(u=document.getElementById("svgOpacitySlider"))||void 0===u||u.addEventListener("input",function(e){v.setOverlayOpacity(e.target.value/100)}),null===(c=document.getElementById("svgRotationSlider"))||void 0===c||c.addEventListener("input",function(e){v.setRotation(parseFloat(e.target.value))}),null===(d=document.getElementById("svgImportConfirm"))||void 0===d||d.addEventListener("click",function(){v.saveAsOverlay()}),this.eventBus.on("svg:highlight_shape",function(e){v.highlightShape(e.index)}),this.eventBus.on("svg:update_colors",function(e){v.shapeMapping=e.mapping,v.updateShapeColors()})}}},{key:"loadSavedOverlay",value:function(){var e=document.getElementById("terreno_svg_content"),t=document.getElementById("terreno_svg_bounds"),n=document.getElementById("terreno_svg_rotation"),o=document.getElementById("terreno_shape_mapping");if(null!=e&&e.value&&(this.svgContent=e.value),null!=t&&t.value)try{var a=JSON.parse(t.value);this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(a.south,a.west),new google.maps.LatLng(a.north,a.east))}catch(e){console.warn("Erro ao carregar bounds:",e)}if(null!=n&&n.value&&(this.overlay.rotation=parseFloat(n.value)||0),null!=o&&o.value)try{this.shapeMapping=JSON.parse(o.value)}catch(e){console.warn("Erro ao carregar mapping:",e)}this.svgContent&&this.overlay.bounds&&this.renderSavedOverlay()}},{key:"renderSavedOverlay",value:function(){var e=this;if(this.svgContent&&this.overlay.bounds){this.parseSVGContent();var t=ne();this.customOverlay=new t(this.overlay.bounds,this.svgContent,this.map,this,!0),this.customOverlay.setMap(this.map),this.overlay.rotation&&this.customOverlay.updateRotation(this.overlay.rotation),setTimeout(function(){e.updateShapeColors(),e.renderShapesInSidebar()},100),console.log("✓ Overlay SVG carregado dos dados salvos")}}},{key:"parseSVGContent",value:function(){if(this.svgContent){var e=(new DOMParser).parseFromString(this.svgContent,"image/svg+xml").documentElement,t=e.getAttribute("viewBox");if(t){var n=t.split(/[\s,]+/).map(parseFloat);this.viewBox={x:n[0]||0,y:n[1]||0,width:n[2]||100,height:n[3]||100}}var o=e.querySelectorAll("polygon, path, polyline, rect");this.shapes=Array.from(o).map(function(e,t){return{index:t,type:e.tagName.toLowerCase(),id:e.id||"shape_".concat(t),fill:e.getAttribute("fill")||"#ccc",stroke:e.getAttribute("stroke")||"#000"}})}}},{key:"openModal",value:function(){this.modal&&(this.isModalOpen=!0,this.modal.style.display="block",this.resetState())}},{key:"closeModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.modal){this.isModalOpen=!1,this.modal.style.display="none";var t=document.getElementById("terreno_svg_content"),n=t&&t.value;e||n||(this.removeOverlay(),this.resetState())}}},{key:"resetState",value:function(){this.svgContent=null,this.svgElement=null,this.shapes=[],this.viewBox=null,this.overlay={bounds:null,rotation:0,scale:1,center:null,width:400,height:400};var e=document.getElementById("svgStep1"),t=document.getElementById("svgStep2");e&&(e.style.display="block"),t&&(t.style.display="none");var n=document.getElementById("svgUploadStatus");n&&(n.style.display="none");var o=document.getElementById("svgImportConfirm");o&&(o.disabled=!0);var a=document.getElementById("svgOpacitySlider");a&&(a.value=70);var r=document.getElementById("svgRotationSlider");r&&(r.value=0);var i=document.getElementById("svgRotationValue");i&&(i.textContent="0°")}},{key:"handleFileUpload",value:(n=Y(U().m(function e(t){var n,o=this;return U().w(function(e){for(;;)switch(e.n){case 0:if(t.name.endsWith(".svg")){e.n=1;break}return alert("Por favor, selecione um arquivo SVG válido."),e.a(2);case 1:(n=new FileReader).onload=function(){var e=Y(U().m(function e(n){return U().w(function(e){for(;;)switch(e.n){case 0:return o.svgContent=n.target.result,e.n=1,o.processSVG(t.name);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}(),n.readAsText(t);case 2:return e.a(2)}},e)})),function(e){return n.apply(this,arguments)})},{key:"processSVG",value:(t=Y(U().m(function e(t){var n,o,a,r,i,s,l,u,c,d,v;return U().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=document.getElementById("svgUploadStatus"),o=document.getElementById("svgFileName"),a=document.getElementById("svgShapeCount"),n&&(n.style.display="block"),o&&(o.textContent="Processando ".concat(t,"...")),a&&(a.textContent=""),(r=new FormData).append("action","terreno_parse_svg"),r.append("nonce",terreno_ajax.nonce),r.append("svg_content",this.svgContent),e.n=1,fetch(terreno_ajax.ajax_url,{method:"POST",body:r});case 1:return i=e.v,e.n=2,i.json();case 2:(s=e.v).success?(this.shapes=s.data.shapes,this.viewBox=s.data.viewBox,o&&(o.textContent=t),a&&(a.textContent="".concat(this.shapes.length," shapes encontrados")),l=document.getElementById("svgStep1"),u=document.getElementById("svgStep2"),l&&(l.style.display="none"),u&&(u.style.display="block"),this.createMapOverlay(),(c=document.getElementById("svgImportConfirm"))&&(c.disabled=!1),this.renderShapesList(),console.log("✓ SVG processado: ".concat(this.shapes.length," shapes"))):(alert("Erro ao processar SVG: "+((null===(d=s.data)||void 0===d?void 0:d.message)||"Erro desconhecido")),n&&(n.style.display="none")),e.n=4;break;case 3:e.p=3,v=e.v,console.error("Erro ao processar SVG:",v),alert("Erro ao processar SVG. Verifique o console para detalhes.");case 4:return e.a(2)}},e,this,[[0,3]])})),function(e){return t.apply(this,arguments)})},{key:"createMapOverlay",value:function(){this.removeOverlay();var e=this.map.getCenter();this.overlay.center={lat:e.lat(),lng:e.lng()};var t=.002*(this.viewBox?this.viewBox.width/this.viewBox.height:1)/2;this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(this.overlay.center.lat-.001,this.overlay.center.lng-t),new google.maps.LatLng(this.overlay.center.lat+.001,this.overlay.center.lng+t));var n=ne();this.customOverlay=new n(this.overlay.bounds,this.svgContent,this.map,this),this.customOverlay.setMap(this.map),this.map.setCenter(e),this.map.setZoom(18)}},{key:"removeOverlay",value:function(){this.customOverlay&&(this.customOverlay.setMap(null),this.customOverlay=null)}},{key:"confirmAndRemoveSvg",value:function(){if(confirm("Tem certeza que deseja remover o SVG? Esta ação irá remover o overlay e todos os mapeamentos de shapes. Você precisará salvar o post para confirmar a remoção.")){this.removeOverlay(),this.svgContent=null,this.svgElement=null,this.shapes=[],this.viewBox=null,this.shapeMapping={},this.overlay={bounds:null,rotation:0,scale:1,center:null,width:400,height:400};var e=document.getElementById("terreno_svg_content"),t=document.getElementById("terreno_svg_bounds"),n=document.getElementById("terreno_svg_rotation"),o=document.getElementById("terreno_shape_mapping");e&&(e.value=""),t&&(t.value=""),n&&(n.value=""),o&&(o.value="");var a=document.getElementById("shapes-sidebar-container"),r=document.getElementById("total-shapes"),i=document.getElementById("shapes-mapped-count");r&&(r.textContent="0"),i&&(i.textContent="0"),a&&(a.innerHTML='\n        <div class="no-lotes" id="no-shapes-message">\n          <div class="no-lotes-icon">\n            <span class="dashicons dashicons-admin-multisite"></span>\n          </div>\n          <p>Nenhum shape carregado.</p>\n          <p class="help-text">Importe um SVG para visualizar os shapes.</p>\n        </div>\n      ');var s=document.getElementById("btn_ajustar_svg"),l=document.getElementById("btn_remover_svg");s&&(s.disabled=!0),l&&l.remove(),this.eventBus.emit("svg:removed",{}),console.log("✓ SVG removido. Salve o post para confirmar a remoção."),alert("SVG removido. Salve o post para confirmar a remoção.")}}},{key:"rotateOverlay",value:function(e){this.overlay.rotation+=e,this.overlay.rotation=this.overlay.rotation%360,this.updateOverlayTransform();var t=document.getElementById("svgRotationSlider"),n=document.getElementById("svgRotationValue");t&&(t.value=this.overlay.rotation),n&&(n.textContent="".concat(Math.round(this.overlay.rotation),"°"))}},{key:"setRotation",value:function(e){if(this.overlay.rotation=e,this.updateOverlayTransform(),this.isModalOpen){var t=document.getElementById("svgRotationValue");t&&(t.textContent="".concat(Math.round(e),"°"))}}},{key:"scaleOverlay",value:function(e){var t;if(this.overlay.bounds&&this.overlay.center){var n=this.overlay.bounds,o=n.getNorthEast(),a=n.getSouthWest(),r=this.overlay.center.lat,i=this.overlay.center.lng,s=(o.lat()-a.lat())/2*e,l=(o.lng()-a.lng())/2*e;this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(r-s,i-l),new google.maps.LatLng(r+s,i+l)),null===(t=this.customOverlay)||void 0===t||t.updateBounds(this.overlay.bounds)}}},{key:"updateOverlayBounds",value:function(){if(this.overlay.bounds&&this.overlay.center){var e=this.overlay.bounds,t=e.getNorthEast(),n=e.getSouthWest(),o=this.overlay.center.lat,a=this.overlay.center.lng,r=(t.lat()-n.lat())/2*this.overlay.scale,i=(t.lng()-n.lng())/2*this.overlay.scale;this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(o-r,a-i),new google.maps.LatLng(o+r,a+i)),this.overlay.scale=1,this.customOverlay&&this.customOverlay.updateBounds(this.overlay.bounds)}}},{key:"updateOverlayTransform",value:function(){this.customOverlay&&this.customOverlay.updateRotation(this.overlay.rotation)}},{key:"setOverlayOpacity",value:function(e){this.customOverlay&&this.customOverlay.setOpacity(e)}},{key:"resetTransform",value:function(){if(this.svgContent&&this.map){this.overlay.rotation=0,this.overlay.scale=1,this.updateOverlayTransform(),this.createMapOverlay();var e=document.getElementById("svgRotationSlider"),t=document.getElementById("svgRotationValue");e&&(e.value=0),t&&(t.textContent="0°")}}},{key:"renderShapesList",value:function(){this.renderShapesInSidebar()}},{key:"renderShapesInSidebar",value:function(){var e=this,t=document.getElementById("shapes-sidebar-container"),n=document.getElementById("total-shapes"),o=document.getElementById("shapes-mapped-count"),a=document.getElementById("no-shapes-message");if(n&&(n.textContent=this.shapes.length),t)if(0!==this.shapes.length){a&&(a.style.display="none");var r=Object.keys(this.shapeMapping||{}).length;o&&(o.textContent=r);var i=this.shapes.map(function(t,n){var o,a,r=null===(o=e.shapeMapping)||void 0===o?void 0:o[n],i=!!r,s=i?"shape-mapped":"shape-unmapped",l=i?"Quadra ".concat(r.bloco," | Lote ").concat(r.lote_id):"Não mapeado";return'\n          <div class="shape-item '.concat(s,'" data-shape-index="').concat(n,'">\n            <div class="shape-header">\n              <span class="shape-color" style="background: ').concat(t.fill||t.stroke||"#ccc",';"></span>\n              <span class="shape-name">').concat(t.id||"Shape ".concat(n+1),'</span>\n              <span class="shape-points">').concat((null===(a=t.points)||void 0===a?void 0:a.length)||0,' pts</span>\n            </div>\n            <div class="shape-status">').concat(l,"</div>\n          </div>\n        ")}).join("");t.innerHTML=i,this.setupShapeItemListeners()}else a&&(a.style.display="block")}},{key:"setupShapeItemListeners",value:function(){var e=this;document.querySelectorAll(".shape-item").forEach(function(t){var n=parseInt(t.dataset.shapeIndex);t.addEventListener("mouseenter",function(){e.highlightShape(n)}),t.addEventListener("mouseleave",function(){e.unhighlightShape(n)}),t.addEventListener("click",function(){e.eventBus.emit("svg:shape_clicked",{index:n})})})}},{key:"unhighlightShape",value:function(e){this.customOverlay&&this.customOverlay.unhighlightShape(e)}},{key:"updateOverlayCenter",value:function(e){var t=this.overlay.center,n=this.overlay.bounds;if(t&&n){var o=e.lat-t.lat,a=e.lng-t.lng,r=n.getNorthEast(),i=n.getSouthWest();this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat()+o,i.lng()+a),new google.maps.LatLng(r.lat()+o,r.lng()+a)),this.overlay.center=e}}},{key:"saveAsOverlay",value:function(){var e=this;try{if(!this.svgContent)return void alert("Nenhum SVG carregado.");if(!this.overlay.bounds)return console.log("Bounds não encontrados, criando overlay..."),this.createMapOverlay(),void setTimeout(function(){e.overlay.bounds?e.completeSaveOverlay():alert("Erro: não foi possível posicionar o SVG no mapa. Tente novamente.")},100);this.completeSaveOverlay()}catch(e){console.error("Erro ao salvar overlay:",e),alert("Erro ao salvar overlay: "+e.message)}}},{key:"completeSaveOverlay",value:function(){if(!this.overlay.bounds)return console.error("Bounds ainda é null após criação do overlay"),void alert("Erro ao posicionar SVG. Recarregue a página e tente novamente.");this.updateHiddenInputs();var e={north:this.overlay.bounds.getNorthEast().lat(),south:this.overlay.bounds.getSouthWest().lat(),east:this.overlay.bounds.getNorthEast().lng(),west:this.overlay.bounds.getSouthWest().lng()};this.eventBus.emit("svg:loaded",{svgContent:this.svgContent,shapes:this.shapes,viewBox:this.viewBox}),this.eventBus.emit("svg:positioned",{bounds:e,rotation:this.overlay.rotation,center:this.overlay.center}),this.closeModal(!0),this.enableEditorMode(),console.log("✓ SVG salvo como overlay permanente"),console.log("  Shapes: ".concat(this.shapes.length)),console.log("  Bounds: N=".concat(e.north,", S=").concat(e.south,", E=").concat(e.east,", W=").concat(e.west)),console.log("  Rotação: ".concat(this.overlay.rotation,"°"))}},{key:"updateHiddenInputs",value:function(){var e=document.querySelector("#terreno-mapa-container");if(e){var t=document.getElementById("terreno_svg_content");t||((t=document.createElement("input")).type="hidden",t.id="terreno_svg_content",t.name="terreno_svg_content",e.appendChild(t)),t.value=this.svgContent||"";var n=document.getElementById("terreno_svg_bounds");n||((n=document.createElement("input")).type="hidden",n.id="terreno_svg_bounds",n.name="terreno_svg_bounds",e.appendChild(n)),this.overlay.bounds&&(n.value=JSON.stringify({north:this.overlay.bounds.getNorthEast().lat(),south:this.overlay.bounds.getSouthWest().lat(),east:this.overlay.bounds.getNorthEast().lng(),west:this.overlay.bounds.getSouthWest().lng()}));var o=document.getElementById("terreno_svg_rotation");o||((o=document.createElement("input")).type="hidden",o.id="terreno_svg_rotation",o.name="terreno_svg_rotation",e.appendChild(o)),o.value=this.overlay.rotation||0}}},{key:"enableEditorMode",value:function(){this.isEditorMode=!0,this.customOverlay&&this.customOverlay.enableEditorMode()}},{key:"disableEditorMode",value:function(){this.isEditorMode=!1,this.customOverlay&&this.customOverlay.disableEditorMode()}},{key:"toggleEditMode",value:function(){this.svgContent&&this.customOverlay?this.openModalForAdjustment():alert("Nenhum SVG carregado. Importe um SVG primeiro.")}},{key:"openModalForAdjustment",value:function(){if(this.modal){this.isModalOpen=!0,this.modal.style.display="block";var e=document.getElementById("svgStep1"),t=document.getElementById("svgStep2");e&&(e.style.display="none"),t&&(t.style.display="block");var n=document.getElementById("svgImportConfirm");n&&(n.disabled=!1,n.textContent="Salvar Ajustes"),this.customOverlay&&this.customOverlay.disableEditorMode();var o=document.getElementById("svgRotationSlider"),a=document.getElementById("svgRotationValue");o&&(o.value=this.overlay.rotation||0),a&&(a.textContent="".concat(Math.round(this.overlay.rotation||0),"°")),console.log("SVG: Modo de ajuste ativado")}}},{key:"highlightShape",value:function(e){this.selectedShapeIndex=e,this.customOverlay&&this.customOverlay.highlightShape(e)}},{key:"updateShapeColors",value:function(){this.customOverlay&&this.customOverlay.updateShapeColors(this.shapeMapping)}},{key:"finalizeImport",value:(e=Y(U().m(function e(){var t,n,o,a,r=this;return U().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.shapes&&0!==this.shapes.length){e.n=1;break}return alert("Nenhum shape para importar."),e.a(2);case 1:if(this.overlay.bounds){e.n=2;break}return alert("Posicione o SVG no mapa primeiro."),e.a(2);case 2:console.log("Iniciando conversão de shapes para polígonos..."),t=this.overlay.bounds.getNorthEast(),n=this.overlay.bounds.getSouthWest(),console.log("Bounds: N=".concat(t.lat(),", S=").concat(n.lat(),", E=").concat(t.lng(),", W=").concat(n.lng())),console.log("Rotação:",this.overlay.rotation),console.log("ViewBox:",this.viewBox),o=[],this.shapes.forEach(function(e,t){if(e.points&&!(e.points.length<3)){var n=e.points.map(function(e){return r.svgPointToLatLng(e)}),a={id:"imported_".concat(Date.now(),"_").concat(t),nome:e.id||"Lote ".concat(t+1),bloco:"",coordinates:n,area:r.calculateArea(n),color:e.fill||r.generateRandomColor(),status:"disponivel",created_at:(new Date).toISOString()};o.push(a)}}),console.log("Convertidos ".concat(o.length," lotes.")),o.forEach(function(e){r.dataPersistence.addLote(e),r.polygonManager.createPolygon(e)}),this.eventBus.emit("lotes:imported",{count:o.length}),this.removeOverlay(),this.closeModal(),o.length>0&&this.polygonManager.centerOnPolygon(o[0].id),alert("✓ ".concat(o.length," lotes importados com sucesso!")),e.n=4;break;case 3:e.p=3,a=e.v,console.error("Erro ao importar lotes:",a),alert("Erro ao importar lotes: "+a.message);case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return e.apply(this,arguments)})},{key:"svgPointToLatLng",value:function(e){var t=this.overlay.bounds,n=this.overlay.rotation,o=this.viewBox,a=(e.x-o.x)/o.width,r=(e.y-o.y)/o.height,i=n*Math.PI/180,s=Math.cos(i),l=Math.sin(i),u=a-.5,c=r-.5,d=u*s-c*l+.5,v=u*l+c*s+.5,g=t.getNorthEast(),p=t.getSouthWest(),h=p.lng()+d*(g.lng()-p.lng());return{lat:g.lat()-v*(g.lat()-p.lat()),lng:h}}},{key:"calculateArea",value:function(e){if(e.length<3)return 0;for(var t=0,n=e.length,o=0;o<n;o++){var a=(o+1)%n;t+=e[o].lng*e[a].lat,t-=e[a].lng*e[o].lat}var r=111e3;return(t=Math.abs(t/2))*r*r}},{key:"generateRandomColor",value:function(){var e=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F06292","#AED581","#FFD54F","#4DB6AC","#7986CB"];return e[Math.floor(Math.random()*e.length)]}}]);var e,t,n}(),te=null;function ne(){return te||(te=function(){function e(t,n,o,a){var r,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return X(this,e),(r=function(e,t,n){return t=W(t),function(e,t){if(t&&("object"==G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,H()?Reflect.construct(t,n||[],W(e).constructor):t.apply(e,n))}(this,e)).bounds=t,r.svgContent=n,r.manager=a,r.div=null,r.rotation=0,r.opacity=.7,r.isDragging=!1,r.isResizing=!1,r.isEditorMode=i,r.selectedShapeIndex=null,r.shapeMapping={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(e,google.maps.OverlayView),$(e,[{key:"onAdd",value:function(){this.div=document.createElement("div"),this.div.style.position="absolute",this.div.style.cursor=this.isEditorMode?"crosshair":"move",this.div.innerHTML=this.svgContent,this.isEditorMode&&this.div.classList.add("svg-editor-overlay");var e=this.div.querySelector("svg");e&&(e.style.width="100%",e.style.height="100%",e.style.opacity=this.opacity,e.style.pointerEvents=this.isEditorMode?"auto":"none"),this.div.style.border="2px dashed #0073aa",this.div.style.boxSizing="border-box",this.isEditorMode||this.addResizeHandles(),this.isEditorMode||this.addDragListeners(),this.isEditorMode&&this.addShapeClickListeners(),this.div.style.zIndex="10",this.getPanes().overlayMouseTarget.appendChild(this.div)}},{key:"addShapeClickListeners",value:function(){var e=this,t=this.div.querySelector("svg");t&&t.querySelectorAll("polygon, path, polyline, rect").forEach(function(t,n){t.style.cursor="pointer",t.style.pointerEvents="auto",t.dataset.shapeIndex=n,t.addEventListener("mouseenter",function(){e.selectedShapeIndex!==n&&(t.style.fill="rgba(0, 115, 170, 0.5)",t.style.stroke="#0073aa",t.style.strokeWidth="3px")}),t.addEventListener("mouseleave",function(){e.selectedShapeIndex!==n&&e.restoreShapeStyle(t,n)}),t.addEventListener("click",function(o){o.stopPropagation(),e.manager.eventBus.emit("svg:shape_clicked",{index:n,shape:t})})})}},{key:"restoreShapeStyle",value:function(e,t){this.shapeMapping[t]?(e.style.fill="rgba(40, 167, 69, 0.4)",e.style.stroke="#28a745",e.style.strokeWidth="2px"):(e.style.fill="rgba(200, 200, 200, 0.3)",e.style.stroke="#666",e.style.strokeWidth="2px")}},{key:"highlightShape",value:function(e){var t,n=null===(t=this.div)||void 0===t?void 0:t.querySelector("svg");if(n){if(null!==this.selectedShapeIndex){var o=n.querySelector('[data-shape-index="'.concat(this.selectedShapeIndex,'"]'));o&&this.restoreShapeStyle(o,this.selectedShapeIndex)}this.selectedShapeIndex=e;var a=n.querySelector('[data-shape-index="'.concat(e,'"]'));a&&(a.style.fill="rgba(255, 193, 7, 0.5)",a.style.stroke="#ffc107",a.style.strokeWidth="4px")}}},{key:"unhighlightShape",value:function(e){var t,n=null===(t=this.div)||void 0===t?void 0:t.querySelector("svg");if(n){var o=n.querySelector('[data-shape-index="'.concat(e,'"]'));o&&this.restoreShapeStyle(o,e),this.selectedShapeIndex===e&&(this.selectedShapeIndex=null)}}},{key:"updateShapeColors",value:function(e){var t,n=this;this.shapeMapping=e||{};var o=null===(t=this.div)||void 0===t?void 0:t.querySelector("svg");o&&o.querySelectorAll("polygon, path, polyline, rect").forEach(function(e,t){n.selectedShapeIndex!==t&&n.restoreShapeStyle(e,t)})}},{key:"enableEditorMode",value:function(){if(this.isEditorMode=!0,this.div){this.div.style.cursor="crosshair",this.div.classList.add("svg-editor-overlay");var e=this.div.querySelector("svg");e&&(e.style.pointerEvents="auto"),this.div.querySelectorAll(".svg-resize-handle").forEach(function(e){return e.remove()}),this.addShapeClickListeners()}}},{key:"disableEditorMode",value:function(){if(this.isEditorMode=!1,this.div){this.div.style.cursor="move",this.div.classList.remove("svg-editor-overlay");var e=this.div.querySelector("svg");e&&(e.style.pointerEvents="none"),this.addResizeHandles(),this.addDragListeners()}}},{key:"addResizeHandles",value:function(){var e=this;["nw","ne","sw","se"].forEach(function(t){var n=document.createElement("div");n.className="svg-resize-handle svg-resize-".concat(t),n.style.cssText="\n        position: absolute;\n        width: 12px;\n        height: 12px;\n        background: #0073aa;\n        border: 2px solid white;\n        border-radius: 50%;\n        cursor: ".concat(t,"-resize;\n        z-index: 1000;\n      "),t.includes("n")&&(n.style.top="-6px"),t.includes("s")&&(n.style.bottom="-6px"),t.includes("w")&&(n.style.left="-6px"),t.includes("e")&&(n.style.right="-6px"),n.addEventListener("mousedown",function(n){n.stopPropagation(),e.startResize(n,t)}),e.div.appendChild(n)})}},{key:"addDragListeners",value:function(){var e=this;this.div.addEventListener("mousedown",function(t){t.target.classList.contains("svg-resize-handle")||e.startDrag(t)}),document.addEventListener("mousemove",function(t){e.isDragging&&e.onDrag(t),e.isResizing&&e.onResize(t)}),document.addEventListener("mouseup",function(){if(e.isDragging||e.isResizing){var t=e.getMap();t&&t.setOptions({draggable:!0}),e.manager.updateHiddenInputs()}e.isDragging=!1,e.isResizing=!1})}},{key:"startDrag",value:function(e){this.isDragging=!0,this.dragStart={x:e.clientX,y:e.clientY,bounds:new google.maps.LatLngBounds(this.bounds.getSouthWest(),this.bounds.getNorthEast())},this.getMap().setOptions({draggable:!1}),e.preventDefault(),e.stopPropagation()}},{key:"onDrag",value:function(e){var t=this.getProjection();if(t){var n=e.clientX-this.dragStart.x,o=e.clientY-this.dragStart.y,a=this.dragStart.bounds.getSouthWest(),r=this.dragStart.bounds.getNorthEast(),i=t.fromLatLngToDivPixel(a),s=t.fromLatLngToDivPixel(r),l=t.fromDivPixelToLatLng(new google.maps.Point(i.x+n,i.y+o)),u=t.fromDivPixelToLatLng(new google.maps.Point(s.x+n,s.y+o));this.bounds=new google.maps.LatLngBounds(l,u),this.manager.overlay.bounds=this.bounds,this.manager.overlay.center={lat:(l.lat()+u.lat())/2,lng:(l.lng()+u.lng())/2},this.draw()}}},{key:"startResize",value:function(e,t){this.isResizing=!0,this.resizeCorner=t,this.resizeStart={x:e.clientX,y:e.clientY,bounds:new google.maps.LatLngBounds(this.bounds.getSouthWest(),this.bounds.getNorthEast())},this.getMap().setOptions({draggable:!1}),e.preventDefault(),e.stopPropagation()}},{key:"onResize",value:function(e){var t=this.getProjection();if(t){var n=this.resizeStart.bounds.getSouthWest(),o=this.resizeStart.bounds.getNorthEast(),a=n,r=o,i=t.fromLatLngToDivPixel(n),s=t.fromLatLngToDivPixel(o),l=e.clientX-this.resizeStart.x,u=e.clientY-this.resizeStart.y;this.resizeCorner.includes("e")&&(r=t.fromDivPixelToLatLng(new google.maps.Point(s.x+l,s.y))),this.resizeCorner.includes("w")&&(a=t.fromDivPixelToLatLng(new google.maps.Point(i.x+l,i.y))),this.resizeCorner.includes("n")&&(r=t.fromDivPixelToLatLng(new google.maps.Point(this.resizeCorner.includes("e")?s.x+l:s.x,s.y+u))),this.resizeCorner.includes("s")&&(a=t.fromDivPixelToLatLng(new google.maps.Point(this.resizeCorner.includes("w")?i.x+l:i.x,i.y+u))),this.bounds=new google.maps.LatLngBounds(a,r),this.manager.overlay.bounds=this.bounds,this.manager.overlay.center={lat:(a.lat()+r.lat())/2,lng:(a.lng()+r.lng())/2},this.draw()}}},{key:"draw",value:function(){if(this.div){var e=this.getProjection();if(e){var t=e.fromLatLngToDivPixel(this.bounds.getSouthWest()),n=e.fromLatLngToDivPixel(this.bounds.getNorthEast());if(t&&n){var o=n.x-t.x,a=t.y-n.y;this.div.style.left=t.x+"px",this.div.style.top=n.y+"px",this.div.style.width=o+"px",this.div.style.height=a+"px",this.div.style.transform="rotate(".concat(this.rotation,"deg)"),this.div.style.transformOrigin="center center"}}}}},{key:"updateBounds",value:function(e){this.bounds=e,this.draw()}},{key:"updateRotation",value:function(e){this.rotation=e,this.draw()}},{key:"setOpacity",value:function(e){if(this.opacity=e,this.div){var t=this.div.querySelector("svg");t&&(t.style.opacity=e)}}},{key:"onRemove",value:function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null)}}])}(),te)}function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function ae(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,re(o.key),o)}}function re(e){var t=function(e){if("object"!=oe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==oe(t)?t:t+""}var ie=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.stateManager=n,this.eventBus=o,this.svgContent=null,this.svgElement=null,this.shapes=[],this.viewBox=null,this.shapeMapping={},this.overlay={bounds:null,rotation:0,center:null},this.customOverlay=null,this.isEditorActive=!1,this.selectedShapeIndex=null,this.editorPanel=null,this.shapesList=null,this.init()},t=[{key:"init",value:function(){this.createEditorPanel(),this.loadSavedData(),this.setupEventListeners()}},{key:"createEditorPanel",value:function(){if(document.getElementById("svgEditorPanel"))this.editorPanel=document.getElementById("svgEditorPanel");else{var e=document.createElement("div");e.id="svgEditorPanel",e.innerHTML='\n      <div class="svg-editor-header">\n        <h3>\n          <span class="dashicons dashicons-admin-appearance"></span>\n          Editor de Lotes SVG\n        </h3>\n        <button type="button" class="button svg-editor-close" title="Fechar">&times;</button>\n      </div>\n\n      <div class="svg-editor-content">\n        \x3c!-- Info do SVG carregado --\x3e\n        <div class="svg-editor-info" id="svgEditorInfo" style="display: none;">\n          <div class="svg-info-item">\n            <span class="dashicons dashicons-images-alt2"></span>\n            <span id="svgEditorShapeCount">0 shapes</span>\n          </div>\n          <div class="svg-info-item">\n            <span class="dashicons dashicons-saved"></span>\n            <span id="svgEditorMappedCount">0 vinculados</span>\n          </div>\n        </div>\n\n        \x3c!-- Instruções --\x3e\n        <div class="svg-editor-instructions">\n          <p><strong>Como usar:</strong></p>\n          <ol>\n            <li>Importe um SVG pelo botão "Importar SVG"</li>\n            <li>Posicione o SVG sobre o mapa</li>\n            <li>Clique em cada shape para vincular ao lote</li>\n            <li>Salve o post para persistir as configurações</li>\n          </ol>\n        </div>\n\n        \x3c!-- Lista de shapes --\x3e\n        <div class="svg-editor-shapes-header" style="display: none;">\n          <h4>Shapes do SVG</h4>\n          <button type="button" class="button button-small" id="svgEditorSelectAll">Selecionar Todos</button>\n        </div>\n        <div class="svg-editor-shapes-list" id="svgEditorShapesList">\n          <p class="no-shapes">Nenhum SVG carregado</p>\n        </div>\n\n        \x3c!-- Ações --\x3e\n        <div class="svg-editor-actions" style="display: none;">\n          <button type="button" class="button" id="svgEditorClearAll">\n            <span class="dashicons dashicons-trash"></span> Limpar Vínculos\n          </button>\n          <button type="button" class="button button-primary" id="svgEditorSave">\n            <span class="dashicons dashicons-yes"></span> Aplicar Configuração\n          </button>\n        </div>\n      </div>\n\n      \x3c!-- Modal de vinculação --\x3e\n      <div class="svg-editor-modal" id="svgEditorModal" style="display: none;">\n        <div class="svg-editor-modal-content">\n          <h4>Vincular Shape ao Lote</h4>\n          <p class="shape-info">Shape: <strong id="modalShapeIndex">-</strong></p>\n\n          <div class="form-group">\n            <label for="modalLoteId">ID da Unidade: <span class="required">*</span></label>\n            <input type="text" id="modalLoteId" placeholder="Ex: 123" />\n            <small>ID da unidade correspondente na API</small>\n          </div>\n\n          <div class="form-group">\n            <label for="modalBloco">Quadra/Bloco: <span class="required">*</span></label>\n            <input type="text" id="modalBloco" placeholder="Ex: A, B, C..." />\n            <small>Bloco onde a unidade está localizada</small>\n          </div>\n\n          <div class="form-group">\n            <label for="modalNome">Nome (opcional):</label>\n            <input type="text" id="modalNome" placeholder="Ex: Lote 01" />\n          </div>\n\n          <div class="modal-actions">\n            <button type="button" class="button" id="modalCancel">Cancelar</button>\n            <button type="button" class="button" id="modalRemove" style="display: none; color: #d63638;">Remover Vínculo</button>\n            <button type="button" class="button button-primary" id="modalSave">Salvar</button>\n          </div>\n        </div>\n      </div>\n    ',this.addStyles(),document.body.appendChild(e),this.editorPanel=e}}},{key:"addStyles",value:function(){if(!document.getElementById("svgEditorStyles")){var e=document.createElement("style");e.id="svgEditorStyles",e.textContent="\n      #svgEditorPanel {\n        display: none;\n        position: fixed;\n        top: 32px;\n        right: 0;\n        width: 320px;\n        height: calc(100vh - 32px);\n        background: #fff;\n        border-left: 1px solid #ddd;\n        box-shadow: -4px 0 20px rgba(0,0,0,0.1);\n        z-index: 9998;\n        overflow: hidden;\n      }\n\n      #svgEditorPanel.active {\n        display: flex;\n        flex-direction: column;\n      }\n\n      .svg-editor-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 15px;\n        background: #f8f9fa;\n        border-bottom: 1px solid #ddd;\n      }\n\n      .svg-editor-header h3 {\n        margin: 0;\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .svg-editor-close {\n        padding: 0 8px !important;\n        font-size: 18px !important;\n        line-height: 1 !important;\n      }\n\n      .svg-editor-content {\n        flex: 1;\n        overflow-y: auto;\n        padding: 15px;\n      }\n\n      .svg-editor-info {\n        display: flex;\n        gap: 15px;\n        padding: 10px;\n        background: #e7f5ff;\n        border-radius: 4px;\n        margin-bottom: 15px;\n      }\n\n      .svg-info-item {\n        display: flex;\n        align-items: center;\n        gap: 5px;\n        font-size: 12px;\n      }\n\n      .svg-editor-instructions {\n        background: #f5f5f5;\n        padding: 12px;\n        border-radius: 4px;\n        margin-bottom: 15px;\n        font-size: 12px;\n      }\n\n      .svg-editor-instructions p {\n        margin: 0 0 8px 0;\n      }\n\n      .svg-editor-instructions ol {\n        margin: 0;\n        padding-left: 18px;\n      }\n\n      .svg-editor-instructions li {\n        margin-bottom: 4px;\n      }\n\n      .svg-editor-shapes-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 10px;\n      }\n\n      .svg-editor-shapes-header h4 {\n        margin: 0;\n        font-size: 13px;\n      }\n\n      .svg-editor-shapes-list {\n        max-height: 300px;\n        overflow-y: auto;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        margin-bottom: 15px;\n      }\n\n      .svg-editor-shapes-list .no-shapes {\n        padding: 20px;\n        text-align: center;\n        color: #666;\n        margin: 0;\n      }\n\n      .shape-item {\n        display: flex;\n        align-items: center;\n        padding: 8px 12px;\n        border-bottom: 1px solid #eee;\n        cursor: pointer;\n        transition: background 0.2s;\n      }\n\n      .shape-item:last-child {\n        border-bottom: none;\n      }\n\n      .shape-item:hover {\n        background: #f0f7fc;\n      }\n\n      .shape-item.selected {\n        background: #e7f5ff;\n        border-left: 3px solid #0073aa;\n      }\n\n      .shape-item.mapped {\n        background: #d4edda;\n      }\n\n      .shape-item.mapped.selected {\n        background: #c3e6cb;\n        border-left: 3px solid #28a745;\n      }\n\n      .shape-color {\n        width: 16px;\n        height: 16px;\n        border-radius: 3px;\n        margin-right: 10px;\n        border: 1px solid #ddd;\n      }\n\n      .shape-info-text {\n        flex: 1;\n        font-size: 12px;\n      }\n\n      .shape-info-text .shape-name {\n        font-weight: 600;\n      }\n\n      .shape-info-text .shape-lote {\n        color: #28a745;\n        font-size: 11px;\n      }\n\n      .shape-status {\n        font-size: 10px;\n        padding: 2px 6px;\n        border-radius: 10px;\n      }\n\n      .shape-status.unmapped {\n        background: #f8d7da;\n        color: #721c24;\n      }\n\n      .shape-status.mapped {\n        background: #d4edda;\n        color: #155724;\n      }\n\n      .svg-editor-actions {\n        display: flex;\n        gap: 10px;\n        padding-top: 15px;\n        border-top: 1px solid #ddd;\n      }\n\n      .svg-editor-actions .button {\n        flex: 1;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 5px;\n      }\n\n      /* Modal */\n      .svg-editor-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0,0,0,0.5);\n        z-index: 100000;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .svg-editor-modal-content {\n        background: #fff;\n        padding: 25px;\n        border-radius: 8px;\n        width: 350px;\n        max-width: 90%;\n      }\n\n      .svg-editor-modal-content h4 {\n        margin: 0 0 15px 0;\n      }\n\n      .svg-editor-modal-content .shape-info {\n        background: #f5f5f5;\n        padding: 8px 12px;\n        border-radius: 4px;\n        margin-bottom: 15px;\n        font-size: 13px;\n      }\n\n      .svg-editor-modal-content .form-group {\n        margin-bottom: 15px;\n      }\n\n      .svg-editor-modal-content label {\n        display: block;\n        margin-bottom: 5px;\n        font-weight: 600;\n      }\n\n      .svg-editor-modal-content label .required {\n        color: #d63638;\n      }\n\n      .svg-editor-modal-content input {\n        width: 100%;\n        padding: 8px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n      }\n\n      .svg-editor-modal-content small {\n        display: block;\n        margin-top: 4px;\n        color: #666;\n        font-size: 11px;\n      }\n\n      .modal-actions {\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n        margin-top: 20px;\n      }\n\n      /* Overlay SVG interativo */\n      .svg-editor-overlay {\n        cursor: crosshair;\n      }\n\n      .svg-editor-overlay svg {\n        width: 100%;\n        height: 100%;\n      }\n\n      .svg-editor-overlay svg polygon,\n      .svg-editor-overlay svg path,\n      .svg-editor-overlay svg polyline,\n      .svg-editor-overlay svg rect {\n        cursor: pointer;\n        transition: fill 0.2s, stroke 0.2s;\n      }\n\n      .svg-editor-overlay svg polygon:hover,\n      .svg-editor-overlay svg path:hover,\n      .svg-editor-overlay svg polyline:hover,\n      .svg-editor-overlay svg rect:hover {\n        fill: rgba(0, 115, 170, 0.5) !important;\n        stroke: #0073aa !important;\n        stroke-width: 3px !important;\n      }\n\n      .svg-editor-overlay svg .shape-mapped {\n        fill: rgba(40, 167, 69, 0.4) !important;\n        stroke: #28a745 !important;\n      }\n\n      .svg-editor-overlay svg .shape-selected {\n        fill: rgba(255, 193, 7, 0.5) !important;\n        stroke: #ffc107 !important;\n        stroke-width: 4px !important;\n      }\n    ",document.head.appendChild(e)}}},{key:"loadSavedData",value:function(){var e=document.getElementById("terreno_svg_content");e&&e.value&&(this.svgContent=e.value);var t=document.getElementById("terreno_svg_bounds");if(t&&t.value)try{this.overlay.bounds=JSON.parse(t.value)}catch(e){console.warn("Erro ao parsear bounds:",e)}var n=document.getElementById("terreno_svg_rotation");n&&n.value&&(this.overlay.rotation=parseFloat(n.value)||0);var o=document.getElementById("terreno_shape_mapping");if(o&&o.value)try{this.shapeMapping=JSON.parse(o.value)}catch(e){console.warn("Erro ao parsear mapping:",e)}this.svgContent&&this.processSVGContent()}},{key:"setupEventListeners",value:function(){var e=this;document.addEventListener("click",function(t){t.target.classList.contains("svg-editor-close")&&e.closeEditor()}),document.addEventListener("click",function(t){"modalCancel"===t.target.id&&e.closeModal(),"modalSave"===t.target.id&&e.saveShapeMapping(),"modalRemove"===t.target.id&&e.removeShapeMapping()}),document.addEventListener("click",function(t){("svgEditorClearAll"===t.target.id||t.target.closest("#svgEditorClearAll"))&&confirm("Tem certeza que deseja remover todos os vínculos?")&&e.clearAllMappings()}),document.addEventListener("click",function(t){("svgEditorSave"===t.target.id||t.target.closest("#svgEditorSave"))&&e.saveConfiguration()}),this.eventBus.on("svg:loaded",function(t){e.onSVGLoaded(t)}),this.eventBus.on("svg:positioned",function(t){e.onSVGPositioned(t)})}},{key:"openEditor",value:function(){this.isEditorActive=!0,this.editorPanel.classList.add("active")}},{key:"closeEditor",value:function(){this.isEditorActive=!1,this.editorPanel.classList.remove("active")}},{key:"toggleEditor",value:function(){this.isEditorActive?this.closeEditor():this.openEditor()}},{key:"onSVGLoaded",value:function(e){this.svgContent=e.svgContent,this.shapes=e.shapes,this.viewBox=e.viewBox,this.processSVGContent(),this.renderShapesList(),this.updateEditorUI(),this.openEditor()}},{key:"onSVGPositioned",value:function(e){this.overlay.bounds=e.bounds,this.overlay.rotation=e.rotation,this.overlay.center=e.center,this.updateHiddenInputs()}},{key:"processSVGContent",value:function(){if(this.svgContent){var e=(new DOMParser).parseFromString(this.svgContent,"image/svg+xml");this.svgElement=e.documentElement;var t=this.svgElement.getAttribute("viewBox");if(t){var n=t.split(/[\s,]+/).map(parseFloat);this.viewBox={x:n[0]||0,y:n[1]||0,width:n[2]||100,height:n[3]||100}}var o=this.svgElement.querySelectorAll("polygon, path, polyline, rect");this.shapes=Array.from(o).map(function(e,t){return{index:t,type:e.tagName.toLowerCase(),id:e.id||"shape_".concat(t),fill:e.getAttribute("fill")||e.style.fill||"#ccc",stroke:e.getAttribute("stroke")||e.style.stroke||"#000"}})}}},{key:"renderShapesList",value:function(){var e=this,t=document.getElementById("svgEditorShapesList");if(t)if(0!==this.shapes.length){var n=this.shapes.map(function(t){var n=e.shapeMapping[t.index],o=!!n,a=o?"Lote ".concat(n.lote_id," - Bloco ").concat(n.bloco):"";return'\n        <div class="shape-item '.concat(o?"mapped":"",'" data-shape-index="').concat(t.index,'">\n          <div class="shape-color" style="background: ').concat(t.fill,"; border-color: ").concat(t.stroke,';"></div>\n          <div class="shape-info-text">\n            <div class="shape-name">').concat(t.id,"</div>\n            ").concat(o?'<div class="shape-lote">'.concat(a,"</div>"):"",'\n          </div>\n          <span class="shape-status ').concat(o?"mapped":"unmapped",'">\n            ').concat(o?"Vinculado":"Pendente","\n          </span>\n        </div>\n      ")}).join("");t.innerHTML=n,t.querySelectorAll(".shape-item").forEach(function(t){t.addEventListener("click",function(){var n=parseInt(t.dataset.shapeIndex);e.selectShape(n)})})}else t.innerHTML='<p class="no-shapes">Nenhum SVG carregado</p>'}},{key:"updateEditorUI",value:function(){var e=document.getElementById("svgEditorInfo"),t=document.querySelector(".svg-editor-shapes-header"),n=document.querySelector(".svg-editor-actions");if(this.shapes.length>0){e&&(e.style.display="flex"),t&&(t.style.display="flex"),n&&(n.style.display="flex"),document.getElementById("svgEditorShapeCount").textContent="".concat(this.shapes.length," shapes");var o=Object.keys(this.shapeMapping).length;document.getElementById("svgEditorMappedCount").textContent="".concat(o," vinculados")}}},{key:"selectShape",value:function(e){this.selectedShapeIndex=e,document.querySelectorAll(".shape-item").forEach(function(t){t.classList.remove("selected"),parseInt(t.dataset.shapeIndex)===e&&t.classList.add("selected")}),this.highlightShapeInOverlay(e),this.openMappingModal(e)}},{key:"highlightShapeInOverlay",value:function(e){this.eventBus.emit("svg:highlight_shape",{index:e})}},{key:"openMappingModal",value:function(e){var t=document.getElementById("svgEditorModal");if(t){var n=this.shapes.find(function(t){return t.index===e}),o=this.shapeMapping[e];document.getElementById("modalShapeIndex").textContent=(null==n?void 0:n.id)||"Shape ".concat(e),document.getElementById("modalLoteId").value=(null==o?void 0:o.lote_id)||"",document.getElementById("modalBloco").value=(null==o?void 0:o.bloco)||"",document.getElementById("modalNome").value=(null==o?void 0:o.nome)||"";var a=document.getElementById("modalRemove");a&&(a.style.display=o?"block":"none"),t.style.display="flex"}}},{key:"closeModal",value:function(){var e=document.getElementById("svgEditorModal");e&&(e.style.display="none"),this.selectedShapeIndex=null}},{key:"saveShapeMapping",value:function(){var e=document.getElementById("modalLoteId").value.trim(),t=document.getElementById("modalBloco").value.trim(),n=document.getElementById("modalNome").value.trim();e?t?(this.shapeMapping[this.selectedShapeIndex]={lote_id:e,bloco:t,nome:n,shape_index:this.selectedShapeIndex},this.renderShapesList(),this.updateEditorUI(),this.updateOverlayColors(),this.updateHiddenInputs(),this.closeModal(),console.log("✓ Shape ".concat(this.selectedShapeIndex," vinculado ao lote ").concat(e))):alert("O Bloco é obrigatório"):alert("O ID da Unidade é obrigatório")}},{key:"removeShapeMapping",value:function(){null!==this.selectedShapeIndex&&(delete this.shapeMapping[this.selectedShapeIndex],this.renderShapesList(),this.updateEditorUI(),this.updateOverlayColors(),this.updateHiddenInputs(),this.closeModal(),console.log("✓ Vínculo removido do shape ".concat(this.selectedShapeIndex)))}},{key:"clearAllMappings",value:function(){this.shapeMapping={},this.renderShapesList(),this.updateEditorUI(),this.updateOverlayColors(),this.updateHiddenInputs(),console.log("✓ Todos os vínculos foram removidos")}},{key:"updateOverlayColors",value:function(){this.eventBus.emit("svg:update_colors",{mapping:this.shapeMapping})}},{key:"updateHiddenInputs",value:function(){var e,t=document.getElementById("terreno_svg_content");t||((t=document.createElement("input")).type="hidden",t.id="terreno_svg_content",t.name="terreno_svg_content",null===(e=document.querySelector("#terreno-mapa-container"))||void 0===e||e.appendChild(t)),t.value=this.svgContent||"";var n,o=document.getElementById("terreno_svg_bounds");o||((o=document.createElement("input")).type="hidden",o.id="terreno_svg_bounds",o.name="terreno_svg_bounds",null===(n=document.querySelector("#terreno-mapa-container"))||void 0===n||n.appendChild(o)),o.value=this.overlay.bounds?JSON.stringify(this.overlay.bounds):"";var a,r=document.getElementById("terreno_svg_rotation");r||((r=document.createElement("input")).type="hidden",r.id="terreno_svg_rotation",r.name="terreno_svg_rotation",null===(a=document.querySelector("#terreno-mapa-container"))||void 0===a||a.appendChild(r)),r.value=this.overlay.rotation||0;var i,s=document.getElementById("terreno_shape_mapping");s||((s=document.createElement("input")).type="hidden",s.id="terreno_shape_mapping",s.name="terreno_shape_mapping",null===(i=document.querySelector("#terreno-mapa-container"))||void 0===i||i.appendChild(s)),s.value=JSON.stringify(this.shapeMapping)}},{key:"saveConfiguration",value:function(){this.updateHiddenInputs(),this.eventBus.emit("svg:configuration_saved",{svgContent:this.svgContent,bounds:this.overlay.bounds,rotation:this.overlay.rotation,mapping:this.shapeMapping}),alert("Configuração aplicada! Não esqueça de salvar o post."),this.closeEditor()}},{key:"getMapping",value:function(){return this.shapeMapping}},{key:"getDataForSave",value:function(){return{svgContent:this.svgContent,bounds:this.overlay.bounds,rotation:this.overlay.rotation,mapping:this.shapeMapping}}}],t&&ae(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function le(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(le=function(){return!!e})()}function ue(e){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ue(e)}function ce(e,t){return ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ce(e,t)}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ve(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,pe(o.key),o)}}function ge(e,t,n){return t&&ve(e.prototype,t),n&&ve(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function pe(e){var t=function(e){if("object"!=se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==se(t)?t:t+""}var he=function(){return ge(function e(t,n,o){de(this,e),this.map=t,this.stateManager=n,this.eventBus=o,this.imageUrl=null,this.overlay={bounds:null,rotation:0,opacity:.7,center:null},this.customOverlay=null,this.isControlsVisible=!1,this.controlPanel=null,console.log("ImageOverlayManager: construtor"),this.init()},[{key:"init",value:function(){var e=this;console.log("ImageOverlayManager: init()");var t=document.getElementById("btn_importar_planta");console.log("ImageOverlayManager: btn_importar_planta encontrado?",!!t),t?t.addEventListener("click",function(t){t.preventDefault(),console.log("ImageOverlayManager: botao clicado"),e.openMediaLibrary()}):setTimeout(function(){var t=document.getElementById("btn_importar_planta");t&&(console.log("ImageOverlayManager: btn encontrado no retry"),t.addEventListener("click",function(t){t.preventDefault(),console.log("ImageOverlayManager: botao clicado (retry)"),e.openMediaLibrary()}))},500);var n=document.getElementById("btn_remover_planta");n&&n.addEventListener("click",function(){return e.removeOverlay()});var o=document.getElementById("btn_ajustar_planta");o?o.addEventListener("click",function(t){t.preventDefault(),console.log("ImageOverlayManager: ajustar posicao clicado"),e.toggleEditMode()}):setTimeout(function(){var t=document.getElementById("btn_ajustar_planta");t&&t.addEventListener("click",function(t){t.preventDefault(),e.toggleEditMode()})},500),this.createControlPanel()}},{key:"toggleEditMode",value:function(){this.imageUrl?this.isControlsVisible?this.hideControls():this.showControls():alert("Nenhuma imagem carregada. Selecione uma imagem primeiro.")}},{key:"createControlPanel",value:function(){this.controlPanel=document.createElement("div"),this.controlPanel.id="imageOverlayControls",this.controlPanel.innerHTML='\n      <div class="image-overlay-header">\n        <span>Planta Humanizada</span>\n        <button type="button" id="imageControlsClose" title="Fechar">&times;</button>\n      </div>\n      <div class="image-overlay-content">\n        <div class="image-overlay-preview">\n          <img id="imageOverlayPreview" src="" alt="Preview" />\n        </div>\n        <div class="image-overlay-controls">\n          <div class="control-group">\n            <label>Opacidade</label>\n            <input type="range" id="imageOpacitySlider" min="10" max="100" value="70" />\n            <span id="imageOpacityValue">70%</span>\n          </div>\n          <div class="control-group">\n            <label>Rotacao</label>\n            <div class="rotation-controls">\n              <button type="button" id="imageRotateLeft" title="Rotacionar -1">&#8634;</button>\n              <input type="range" id="imageRotationSlider" min="-180" max="180" value="0" />\n              <button type="button" id="imageRotateRight" title="Rotacionar +1">&#8635;</button>\n            </div>\n            <span id="imageRotationValue">0</span>\n          </div>\n          <div class="control-group">\n            <label>Escala</label>\n            <div class="scale-controls">\n              <button type="button" id="imageZoomOut" title="Diminuir">-</button>\n              <button type="button" id="imageZoomIn" title="Aumentar">+</button>\n              <button type="button" id="imageResetScale" title="Resetar">Reset</button>\n            </div>\n          </div>\n        </div>\n        <div class="image-overlay-actions">\n          <button type="button" id="imageRemoveBtn" class="button">Remover Imagem</button>\n        </div>\n      </div>\n    ',this.addControlPanelStyles(),document.body.appendChild(this.controlPanel),this.setupControlListeners()}},{key:"addControlPanelStyles",value:function(){if(!document.getElementById("imageOverlayStyles")){var e=document.createElement("style");e.id="imageOverlayStyles",e.textContent='\n      #imageOverlayControls {\n        position: fixed;\n        top: 50px;\n        right: -320px;\n        width: 300px;\n        background: #fff;\n        border: 1px solid #ccc;\n        border-radius: 4px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n        z-index: 9998;\n        transition: right 0.3s ease;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n      }\n      #imageOverlayControls.active {\n        right: 10px;\n      }\n      .image-overlay-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 10px 15px;\n        background: #0073aa;\n        color: #fff;\n        border-radius: 4px 4px 0 0;\n      }\n      .image-overlay-header button {\n        background: none;\n        border: none;\n        color: #fff;\n        font-size: 20px;\n        cursor: pointer;\n        padding: 0;\n        line-height: 1;\n      }\n      .image-overlay-content {\n        padding: 15px;\n      }\n      .image-overlay-preview {\n        margin-bottom: 15px;\n        text-align: center;\n      }\n      .image-overlay-preview img {\n        max-width: 100%;\n        max-height: 120px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n      }\n      .image-overlay-controls .control-group {\n        margin-bottom: 15px;\n      }\n      .image-overlay-controls label {\n        display: block;\n        margin-bottom: 5px;\n        font-weight: 600;\n        font-size: 12px;\n        color: #333;\n      }\n      .image-overlay-controls input[type="range"] {\n        width: 100%;\n      }\n      .image-overlay-controls span {\n        display: block;\n        text-align: center;\n        font-size: 12px;\n        color: #666;\n        margin-top: 3px;\n      }\n      .rotation-controls, .scale-controls {\n        display: flex;\n        gap: 5px;\n        align-items: center;\n      }\n      .rotation-controls input[type="range"] {\n        flex: 1;\n      }\n      .rotation-controls button, .scale-controls button {\n        padding: 5px 10px;\n        font-size: 14px;\n        cursor: pointer;\n        border: 1px solid #ccc;\n        background: #f7f7f7;\n        border-radius: 3px;\n      }\n      .rotation-controls button:hover, .scale-controls button:hover {\n        background: #e5e5e5;\n      }\n      .image-overlay-actions {\n        margin-top: 15px;\n        padding-top: 15px;\n        border-top: 1px solid #eee;\n      }\n      .image-overlay-actions button {\n        width: 100%;\n        padding: 8px;\n        cursor: pointer;\n      }\n      #imageRemoveBtn {\n        background: #dc3545;\n        color: #fff;\n        border-color: #dc3545;\n      }\n      #imageRemoveBtn:hover {\n        background: #c82333;\n      }\n    ',document.head.appendChild(e)}}},{key:"setupControlListeners",value:function(){var e,t,n,o,a,r,i,s,l,u=this;null===(e=document.getElementById("imageControlsClose"))||void 0===e||e.addEventListener("click",function(){u.hideControls()}),null===(t=document.getElementById("imageOpacitySlider"))||void 0===t||t.addEventListener("input",function(e){var t=e.target.value/100;u.setOverlayOpacity(t),document.getElementById("imageOpacityValue").textContent="".concat(e.target.value,"%")}),null===(n=document.getElementById("imageRotationSlider"))||void 0===n||n.addEventListener("input",function(e){u.setRotation(parseFloat(e.target.value)),document.getElementById("imageRotationValue").textContent="".concat(e.target.value)}),null===(o=document.getElementById("imageRotateLeft"))||void 0===o||o.addEventListener("click",function(){u.rotateOverlay(-1)}),null===(a=document.getElementById("imageRotateRight"))||void 0===a||a.addEventListener("click",function(){u.rotateOverlay(1)}),null===(r=document.getElementById("imageZoomIn"))||void 0===r||r.addEventListener("click",function(){u.scaleOverlay(1.1)}),null===(i=document.getElementById("imageZoomOut"))||void 0===i||i.addEventListener("click",function(){u.scaleOverlay(.9)}),null===(s=document.getElementById("imageResetScale"))||void 0===s||s.addEventListener("click",function(){u.resetTransform()}),null===(l=document.getElementById("imageRemoveBtn"))||void 0===l||l.addEventListener("click",function(){u.removeOverlay()})}},{key:"openMediaLibrary",value:function(){var e=this;if(console.log("ImageOverlayManager: openMediaLibrary()"),console.log("ImageOverlayManager: wp disponivel?","undefined"!=typeof wp),console.log("ImageOverlayManager: wp.media disponivel?","undefined"!=typeof wp&&void 0!==wp.media),"undefined"==typeof wp||void 0===wp.media)return alert("Media Library nao disponivel. Recarregue a pagina."),void console.error("ImageOverlayManager: wp.media nao disponivel");var t=wp.media({title:"Selecionar Planta Humanizada",button:{text:"Usar esta imagem"},multiple:!1,library:{type:"image"}});t.on("select",function(){var n=t.state().get("selection").first().toJSON();e.handleImageSelect(n.url)}),t.open()}},{key:"handleImageSelect",value:function(e){this.imageUrl=e;var t=document.getElementById("imageOverlayPreview");t&&(t.src=e),this.createMapOverlay(),this.showControls(),this.updateAjustarButton(!0),this.updateHiddenInputs(),console.log("Planta humanizada carregada:",e)}},{key:"updateAjustarButton",value:function(e){var t=document.getElementById("btn_ajustar_planta");t&&(t.disabled=!e)}},{key:"createMapOverlay",value:function(){var e=this;this.customOverlay&&this.customOverlay.setMap(null);var t=new Image;t.onload=function(){var n=t.naturalWidth/t.naturalHeight,o=e.map.getCenter();e.overlay.center={lat:o.lat(),lng:o.lng()};var a,r;n>1?(a=.0015,r=.003/n/2):(r=.0015,a=.003*n/2),e.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(e.overlay.center.lat-r,e.overlay.center.lng-a),new google.maps.LatLng(e.overlay.center.lat+r,e.overlay.center.lng+a));var i=me();e.customOverlay=new i(e.overlay.bounds,e.imageUrl,e.map,e),e.customOverlay.setMap(e.map),e.map.setCenter(o),e.map.setZoom(18),e.updateHiddenInputs()},t.onerror=function(){console.error("Erro ao carregar imagem para calcular dimensões"),e.createMapOverlayFallback()},t.src=this.imageUrl}},{key:"createMapOverlayFallback",value:function(){var e=this.map.getCenter();this.overlay.center={lat:e.lat(),lng:e.lng()};var t=.0015;this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(this.overlay.center.lat-t,this.overlay.center.lng-t),new google.maps.LatLng(this.overlay.center.lat+t,this.overlay.center.lng+t));var n=me();this.customOverlay=new n(this.overlay.bounds,this.imageUrl,this.map,this),this.customOverlay.setMap(this.map),this.map.setCenter(e),this.map.setZoom(18)}},{key:"showControls",value:function(){var e;this.isControlsVisible=!0,null===(e=this.controlPanel)||void 0===e||e.classList.add("active")}},{key:"hideControls",value:function(){var e;this.isControlsVisible=!1,null===(e=this.controlPanel)||void 0===e||e.classList.remove("active")}},{key:"removeOverlay",value:function(){this.customOverlay&&(this.customOverlay.setMap(null),this.customOverlay=null),this.imageUrl=null,this.overlay={bounds:null,rotation:0,opacity:.7,center:null};var e=document.getElementById("imageOverlayPreview");e&&(e.src=""),this.hideControls(),this.updateAjustarButton(!1),this.clearHiddenInputs(),console.log("Planta humanizada removida")}},{key:"setOverlayOpacity",value:function(e){this.overlay.opacity=e,this.customOverlay&&this.customOverlay.setOpacity(e),this.updateHiddenInputs()}},{key:"rotateOverlay",value:function(e){this.overlay.rotation+=e,this.overlay.rotation=(this.overlay.rotation%360+360)%360,this.overlay.rotation>180&&(this.overlay.rotation-=360),this.updateOverlayTransform();var t=document.getElementById("imageRotationSlider"),n=document.getElementById("imageRotationValue");t&&(t.value=this.overlay.rotation),n&&(n.textContent="".concat(Math.round(this.overlay.rotation))),this.updateHiddenInputs()}},{key:"setRotation",value:function(e){this.overlay.rotation=e,this.updateOverlayTransform(),this.updateHiddenInputs()}},{key:"scaleOverlay",value:function(e){var t;if(this.overlay.bounds&&this.overlay.center){var n=this.overlay.bounds,o=n.getNorthEast(),a=n.getSouthWest(),r=this.overlay.center.lat,i=this.overlay.center.lng,s=(o.lat()-a.lat())/2*e,l=(o.lng()-a.lng())/2*e;this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(r-s,i-l),new google.maps.LatLng(r+s,i+l)),null===(t=this.customOverlay)||void 0===t||t.updateBounds(this.overlay.bounds),this.updateHiddenInputs()}}},{key:"resetTransform",value:function(){if(this.imageUrl&&this.map){this.overlay.rotation=0,this.createMapOverlay();var e=document.getElementById("imageRotationSlider"),t=document.getElementById("imageRotationValue");e&&(e.value=0),t&&(t.textContent="0"),this.updateHiddenInputs()}}},{key:"updateOverlayTransform",value:function(){this.customOverlay&&this.customOverlay.updateRotation(this.overlay.rotation)}},{key:"loadSavedOverlay",value:function(){var e=document.getElementById("terreno_image_url"),t=document.getElementById("terreno_image_bounds"),n=document.getElementById("terreno_image_rotation"),o=document.getElementById("terreno_image_opacity");if(null!=e&&e.value){this.imageUrl=e.value;var a=document.getElementById("imageOverlayPreview");a&&(a.src=this.imageUrl)}if(null!=t&&t.value)try{var r=JSON.parse(t.value);this.overlay.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(r.south,r.west),new google.maps.LatLng(r.north,r.east)),this.overlay.center={lat:(r.north+r.south)/2,lng:(r.east+r.west)/2}}catch(e){console.warn("Erro ao carregar bounds da imagem:",e)}null!=n&&n.value&&(this.overlay.rotation=parseFloat(n.value)||0),null!=o&&o.value&&(this.overlay.opacity=parseFloat(o.value)||.7),this.imageUrl&&this.overlay.bounds?(this.renderSavedOverlay(),this.updateAjustarButton(!0)):this.imageUrl&&this.updateAjustarButton(!0)}},{key:"renderSavedOverlay",value:function(){if(this.imageUrl&&this.overlay.bounds){var e=me();this.customOverlay=new e(this.overlay.bounds,this.imageUrl,this.map,this),this.customOverlay.setMap(this.map),this.overlay.rotation&&this.customOverlay.updateRotation(this.overlay.rotation),this.overlay.opacity&&this.customOverlay.setOpacity(this.overlay.opacity);var t=document.getElementById("imageRotationSlider"),n=document.getElementById("imageRotationValue"),o=document.getElementById("imageOpacitySlider"),a=document.getElementById("imageOpacityValue");t&&(t.value=this.overlay.rotation),n&&(n.textContent="".concat(Math.round(this.overlay.rotation))),o&&(o.value=100*this.overlay.opacity),a&&(a.textContent="".concat(Math.round(100*this.overlay.opacity),"%")),console.log("Overlay de imagem carregado dos dados salvos")}}},{key:"updateHiddenInputs",value:function(){var e=document.querySelector("#terreno-mapa-container");if(e){var t=document.getElementById("terreno_image_url");t||((t=document.createElement("input")).type="hidden",t.id="terreno_image_url",t.name="terreno_image_url",e.appendChild(t)),t.value=this.imageUrl||"";var n=document.getElementById("terreno_image_bounds");n||((n=document.createElement("input")).type="hidden",n.id="terreno_image_bounds",n.name="terreno_image_bounds",e.appendChild(n)),this.overlay.bounds&&(n.value=JSON.stringify({north:this.overlay.bounds.getNorthEast().lat(),south:this.overlay.bounds.getSouthWest().lat(),east:this.overlay.bounds.getNorthEast().lng(),west:this.overlay.bounds.getSouthWest().lng()}));var o=document.getElementById("terreno_image_rotation");o||((o=document.createElement("input")).type="hidden",o.id="terreno_image_rotation",o.name="terreno_image_rotation",e.appendChild(o)),o.value=this.overlay.rotation||0;var a=document.getElementById("terreno_image_opacity");a||((a=document.createElement("input")).type="hidden",a.id="terreno_image_opacity",a.name="terreno_image_opacity",e.appendChild(a)),a.value=this.overlay.opacity||.7}}},{key:"clearHiddenInputs",value:function(){["terreno_image_url","terreno_image_bounds","terreno_image_rotation","terreno_image_opacity"].forEach(function(e){var t=document.getElementById(e);t&&(t.value="")})}}])}(),ye=null;function me(){return ye||(ye=function(){function e(t,n,o,a){var r;return de(this,e),(r=function(e,t,n){return t=ue(t),function(e,t){if(t&&("object"==se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,le()?Reflect.construct(t,n||[],ue(e).constructor):t.apply(e,n))}(this,e)).bounds=t,r.imageUrl=n,r.manager=a,r.div=null,r.img=null,r.rotation=0,r.opacity=.7,r.isDragging=!1,r.isResizing=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ce(e,t)}(e,google.maps.OverlayView),ge(e,[{key:"onAdd",value:function(){this.div=document.createElement("div"),this.div.style.position="absolute",this.div.style.cursor="move",this.img=document.createElement("img"),this.img.src=this.imageUrl,this.img.style.width="100%",this.img.style.height="100%",this.img.style.opacity=this.opacity,this.img.style.pointerEvents="none",this.img.style.objectFit="contain",this.div.appendChild(this.img),this.div.style.border="2px dashed #28a745",this.div.style.boxSizing="border-box",this.addResizeHandles(),this.addDragListeners(),this.div.style.zIndex="1",this.getPanes().overlayMouseTarget.appendChild(this.div)}},{key:"addResizeHandles",value:function(){var e=this;["nw","ne","sw","se"].forEach(function(t){var n=document.createElement("div");n.className="image-resize-handle image-resize-".concat(t),n.style.cssText="\n          position: absolute;\n          width: 14px;\n          height: 14px;\n          background: #28a745;\n          border: 2px solid white;\n          border-radius: 50%;\n          cursor: ".concat(t,"-resize;\n          z-index: 1000;\n        "),t.includes("n")&&(n.style.top="-7px"),t.includes("s")&&(n.style.bottom="-7px"),t.includes("w")&&(n.style.left="-7px"),t.includes("e")&&(n.style.right="-7px"),n.addEventListener("mousedown",function(n){n.stopPropagation(),e.startResize(n,t)}),e.div.appendChild(n)})}},{key:"addDragListeners",value:function(){var e=this;this.div.addEventListener("mousedown",function(t){t.target.classList.contains("image-resize-handle")||e.startDrag(t)}),document.addEventListener("mousemove",function(t){e.isDragging&&e.onDrag(t),e.isResizing&&e.onResize(t)}),document.addEventListener("mouseup",function(){if(e.isDragging||e.isResizing){e.manager.updateHiddenInputs();var t=e.getMap();t&&t.setOptions({draggable:!0})}e.isDragging=!1,e.isResizing=!1})}},{key:"startDrag",value:function(e){this.isDragging=!0,this.dragStart={x:e.clientX,y:e.clientY,bounds:new google.maps.LatLngBounds(this.bounds.getSouthWest(),this.bounds.getNorthEast())},this.getMap().setOptions({draggable:!1}),e.preventDefault(),e.stopPropagation()}},{key:"onDrag",value:function(e){var t=this.getProjection();if(t){var n=e.clientX-this.dragStart.x,o=e.clientY-this.dragStart.y,a=this.dragStart.bounds.getSouthWest(),r=this.dragStart.bounds.getNorthEast(),i=t.fromLatLngToDivPixel(a),s=t.fromLatLngToDivPixel(r),l=t.fromDivPixelToLatLng(new google.maps.Point(i.x+n,i.y+o)),u=t.fromDivPixelToLatLng(new google.maps.Point(s.x+n,s.y+o));this.bounds=new google.maps.LatLngBounds(l,u),this.manager.overlay.bounds=this.bounds,this.manager.overlay.center={lat:(l.lat()+u.lat())/2,lng:(l.lng()+u.lng())/2},this.draw()}}},{key:"startResize",value:function(e,t){this.isResizing=!0,this.resizeCorner=t,this.resizeStart={x:e.clientX,y:e.clientY,bounds:new google.maps.LatLngBounds(this.bounds.getSouthWest(),this.bounds.getNorthEast())},this.getMap().setOptions({draggable:!1}),e.preventDefault(),e.stopPropagation()}},{key:"onResize",value:function(e){var t=this.getProjection();if(t){var n=this.resizeStart.bounds.getSouthWest(),o=this.resizeStart.bounds.getNorthEast(),a=n,r=o,i=t.fromLatLngToDivPixel(n),s=t.fromLatLngToDivPixel(o),l=e.clientX-this.resizeStart.x,u=e.clientY-this.resizeStart.y;this.resizeCorner.includes("e")&&(r=t.fromDivPixelToLatLng(new google.maps.Point(s.x+l,s.y))),this.resizeCorner.includes("w")&&(a=t.fromDivPixelToLatLng(new google.maps.Point(i.x+l,i.y))),this.resizeCorner.includes("n")&&(r=t.fromDivPixelToLatLng(new google.maps.Point(this.resizeCorner.includes("e")?s.x+l:s.x,s.y+u))),this.resizeCorner.includes("s")&&(a=t.fromDivPixelToLatLng(new google.maps.Point(this.resizeCorner.includes("w")?i.x+l:i.x,i.y+u))),this.bounds=new google.maps.LatLngBounds(a,r),this.manager.overlay.bounds=this.bounds,this.manager.overlay.center={lat:(a.lat()+r.lat())/2,lng:(a.lng()+r.lng())/2},this.draw()}}},{key:"draw",value:function(){if(this.div){var e=this.getProjection();if(e){var t=e.fromLatLngToDivPixel(this.bounds.getSouthWest()),n=e.fromLatLngToDivPixel(this.bounds.getNorthEast());if(t&&n){var o=n.x-t.x,a=t.y-n.y;this.div.style.left=t.x+"px",this.div.style.top=n.y+"px",this.div.style.width=o+"px",this.div.style.height=a+"px",this.div.style.transform="rotate(".concat(this.rotation,"deg)"),this.div.style.transformOrigin="center center"}}}}},{key:"updateBounds",value:function(e){this.bounds=e,this.draw()}},{key:"updateRotation",value:function(e){this.rotation=e,this.draw()}},{key:"setOpacity",value:function(e){this.opacity=e,this.img&&(this.img.style.opacity=e)}},{key:"onRemove",value:function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null,this.img=null)}}])}())}function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}function be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,we(o.key),o)}}function we(e){var t=function(e){if("object"!=fe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==fe(t)?t:t+""}var Ee=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"pathToArray",value:function(e){for(var t=[],n=0;n<e.getLength();n++){var o=e.getAt(n);t.push({lat:o.lat(),lng:o.lng()})}return t}},{key:"arrayToLatLngArray",value:function(e){return e.map(function(e){return new google.maps.LatLng(e.lat,e.lng)})}},{key:"validateCoordinates",value:function(e,t){return!("number"!=typeof e||"number"!=typeof t||isNaN(e)||isNaN(t)||e<-90||e>90||t<-180||t>180)}},{key:"getPolygonCenter",value:function(e){if(!e||0===e.length)return null;var t=0,n=0;return e.forEach(function(e){t+=e.lat,n+=e.lng}),{lat:t/e.length,lng:n/e.length}}},{key:"getBounds",value:function(e){if(!e||0===e.length)return null;var t=new google.maps.LatLngBounds;return e.forEach(function(e){t.extend(new google.maps.LatLng(e.lat,e.lng))}),t}},{key:"formatCoordinates",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return"".concat(e.toFixed(n),", ").concat(t.toFixed(n))}},{key:"calculateDistance",value:function(e,t){var n=e.lat*Math.PI/180,o=t.lat*Math.PI/180,a=(t.lat-e.lat)*Math.PI/180,r=(t.lng-e.lng)*Math.PI/180,i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(o)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}},{key:"simplifyPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e.length<=3)return e;for(var n=[e[0]],o=1;o<e.length-1;o++)this.calculateDistance(n[n.length-1],e[o])>=t&&n.push(e[o]);return n.push(e[e.length-1]),n}},{key:"isPointInPolygon",value:function(e,t){var n=new google.maps.LatLng(e.lat,e.lng),o=new google.maps.Polygon({paths:t});return google.maps.geometry.poly.containsLocation(n,o)}}],null&&be(e.prototype,null),t&&be(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function ke(e){return function(e){if(Array.isArray(e))return xe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return xe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function Le(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Me(o.key),o)}}function Me(e){var t=function(e){if("object"!=Se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Se(t)?t:t+""}var Oe=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"calculateArea",value:function(e){if(!e||!e.getPath)return console.error("Polígono inválido para cálculo de área"),0;var t=google.maps.geometry.spherical.computeArea(e.getPath());return Math.round(100*t)/100}},{key:"calculateAreaFromCoordinates",value:function(e){if(!e||e.length<3)return 0;var t=e.map(function(e){return new google.maps.LatLng(e.lat,e.lng)}),n=google.maps.geometry.spherical.computeArea(t);return Math.round(100*n)/100}},{key:"formatArea",value:function(e){if("number"!=typeof e||isNaN(e))return"0 m²";var t=e.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});return"".concat(t," m²")}},{key:"toHectares",value:function(e){return e/1e4}},{key:"formatAsHectares",value:function(e){var t=this.toHectares(e).toLocaleString("pt-BR",{minimumFractionDigits:4,maximumFractionDigits:4});return"".concat(t," ha")}},{key:"formatSmart",value:function(e){return e>=1e4?this.formatAsHectares(e):this.formatArea(e)}},{key:"calculatePerimeter",value:function(e){if(!e||!e.getPath)return 0;for(var t=e.getPath(),n=0,o=0;o<t.getLength();o++){var a=t.getAt(o),r=t.getAt((o+1)%t.getLength());n+=google.maps.geometry.spherical.computeDistanceBetween(a,r)}return Math.round(100*n)/100}},{key:"calculatePerimeterFromCoordinates",value:function(e){if(!e||e.length<3)return 0;for(var t=0,n=0;n<e.length;n++){var o=new google.maps.LatLng(e[n].lat,e[n].lng),a=new google.maps.LatLng(e[(n+1)%e.length].lat,e[(n+1)%e.length].lng);t+=google.maps.geometry.spherical.computeDistanceBetween(o,a)}return Math.round(100*t)/100}},{key:"formatPerimeter",value:function(e){return"number"!=typeof e||isNaN(e)?"0 m":e>=1e3?"".concat((e/1e3).toFixed(2)," km"):"".concat(e.toFixed(2)," m")}},{key:"calculateTotalArea",value:function(e){var t=this;return e&&Array.isArray(e)?e.reduce(function(e,n){return e+t.calculateArea(n)},0):0}},{key:"calculateStatistics",value:function(e){var t=this;if(!e||!Array.isArray(e)||0===e.length)return{total:0,average:0,min:0,max:0,count:0};var n=e.map(function(e){return t.calculateArea(e)});return{total:n.reduce(function(e,t){return e+t},0),average:n.reduce(function(e,t){return e+t},0)/n.length,min:Math.min.apply(Math,ke(n)),max:Math.max.apply(Math,ke(n)),count:n.length}}}],null&&Le(e.prototype,null),t&&Le(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Pe(e){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pe(e)}function Ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Be(o.key),o)}}function Be(e){var t=function(e){if("object"!=Pe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Pe(t)?t:t+""}var Ce,_e,je,De=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"getElement",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&this.elementCache.has(e))return this.elementCache.get(e);var n=document.getElementById(e);return n&&t&&this.elementCache.set(e,n),n}},{key:"getValue",value:function(e){var t=this.getElement(e);return t?t.value:""}},{key:"setValue",value:function(e,t){var n=this.getElement(e);return n?(n.value=t,!0):(console.warn('Elemento com ID "'.concat(e,'" não encontrado')),!1)}},{key:"show",value:function(e){var t=this.getElement(e);t&&(t.style.display="",t.classList.remove("hidden"))}},{key:"hide",value:function(e){var t=this.getElement(e);t&&t.classList.add("hidden")}},{key:"toggle",value:function(e){var t=this.getElement(e);t&&t.classList.toggle("hidden")}},{key:"addClass",value:function(e,t){var n=this.getElement(e);n&&n.classList.add(t)}},{key:"removeClass",value:function(e,t){var n=this.getElement(e);n&&n.classList.remove(t)}},{key:"setText",value:function(e,t){var n=this.getElement(e);n&&(n.textContent=t)}},{key:"setHTML",value:function(e,t){var n=this.getElement(e);n&&(n.innerHTML=t)}},{key:"clearCache",value:function(){this.elementCache.clear()}},{key:"removeFromCache",value:function(e){this.elementCache.delete(e)}},{key:"addEventListener",value:function(e,t,n){var o=this.getElement(e);return o?(o.addEventListener(t,n),!0):(console.warn('Elemento com ID "'.concat(e,'" não encontrado para event listener')),!1)}},{key:"enable",value:function(e){var t=this.getElement(e);t&&(t.disabled=!1)}},{key:"disable",value:function(e){var t=this.getElement(e);t&&(t.disabled=!0)}},{key:"exists",value:function(e){return null!==this.getElement(e)}},{key:"focus",value:function(e){var t=this.getElement(e);t&&"function"==typeof t.focus&&t.focus()}},{key:"createElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=document.createElement(e);return Object.keys(t).forEach(function(e){"class"===e?o.className=t[e]:"style"===e?Object.assign(o.style,t[e]):o.setAttribute(e,t[e])}),n&&(o.innerHTML=n),o}},{key:"clearChildren",value:function(e){var t=this.getElement(e);if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}}],null&&Ie(e.prototype,null),t&&Ie(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Te(e){return Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ze(o.key),o)}}function ze(e){var t=function(e){if("object"!=Te(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Te(t)?t:t+""}Ce=De,_e="elementCache",je=new Map,(_e=Be(_e))in Ce?Object.defineProperty(Ce,_e,{value:je,enumerable:!0,configurable:!0,writable:!0}):Ce[_e]=je;var Re=function(){return function(e,t,n){return n&&Ae(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},0,[{key:"random",value:function(){var e=Math.floor(Math.random()*this.PALETTE.length);return this.PALETTE[e]}},{key:"fromPalette",value:function(e){var t=e%this.PALETTE.length;return this.PALETTE[t]}},{key:"randomHex",value:function(){return"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}},{key:"fromId",value:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);var o=Math.abs(t)%this.PALETTE.length;return this.PALETTE[o]}},{key:"fromStatus",value:function(e){return{disponivel:"#4ECDC4",vendido:"#FF6B6B",reservado:"#FFD54F"}[e]||this.random()}},{key:"darken",value:function(e,t){var n=parseInt(e.replace("#",""),16),o=Math.round(2.55*t),a=(n>>16)-o,r=(n>>8&255)-o,i=(255&n)-o;return"#"+(16777216+65536*(a<255?a<1?0:a:255)+256*(r<255?r<1?0:r:255)+(i<255?i<1?0:i:255)).toString(16).slice(1)}},{key:"lighten",value:function(e,t){var n=parseInt(e.replace("#",""),16),o=Math.round(2.55*t),a=(n>>16)+o,r=(n>>8&255)+o,i=(255&n)+o;return"#"+(16777216+65536*(a<255?a:255)+256*(r<255?r:255)+(i<255?i:255)).toString(16).slice(1)}},{key:"hexToRgb",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},{key:"rgbToHex",value:function(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}},{key:"getContrastColor",value:function(e){var t=this.hexToRgb(e);return t?(.299*t.r+.587*t.g+.114*t.b)/255>.5?"#000000":"#FFFFFF":"#000000"}}])}();function Fe(e){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(e)}function Ne(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ve(o.key),o)}}function Ve(e){var t=function(e){if("object"!=Fe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Fe(t)?t:t+""}!function(e,t,n){(t=ze(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(Re,"PALETTE",["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F06292","#AED581","#FFD54F","#4DB6AC","#7986CB","#9575CD","#F06292","#BA68C8","#4FC3F7","#81C784","#DCE775","#FFB74D","#FF8A65","#A1887F","#90A4AE"]);var Ge=function(){return function(e,t){return t&&Ne(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stateManager=t,this.eventBus=n},[{key:"updateDrawingButtons",value:function(e){e?(De.hide("desenhar_lote"),De.show("aplicar_desenho"),De.show("cancelar_desenho"),De.setText("modo_desenho","MODO DESENHO ATIVO")):(De.show("desenhar_lote"),De.hide("aplicar_desenho"),De.hide("cancelar_desenho"),De.setText("modo_desenho",""))}},{key:"renderLotesList",value:function(e){var t=this,n=De.getElement("lista-lotes-container");if(n){if(!e||0===e.length)return this.renderEmptyState(n),this.updateLotesCounter(0),void this.updateTotalArea(0);De.clearChildren("lista-lotes-container"),e.forEach(function(e){var o=t.createLoteElement(e);n.appendChild(o)}),this.updateLotesCounter(e.length),this.updateTotalArea(this.calculateTotalArea(e))}else console.warn("Container de lotes não encontrado")}},{key:"renderEmptyState",value:function(e){De.setHTML("lista-lotes-container",'\n      <div class="no-lotes">\n        <div class="no-lotes-icon">\n          <span class="dashicons dashicons-admin-multisite"></span>\n        </div>\n        <p>Nenhum lote cadastrado ainda.</p>\n        <p class="help-text">Clique em "Desenhar Novo Lote" para começar.</p>\n      </div>\n    ')}},{key:"createLoteElement",value:function(e){var t=De.createElement("div",{class:"lote-item","data-lote-id":e.id}),n="status-".concat(e.status||"disponivel"),o=this.getStatusLabel(e.status),a=Oe.formatArea(e.area||0);return t.innerHTML='\n      <h5>\n        <span class="dashicons dashicons-location"></span>\n        '.concat(e.nome||e.id,'\n        <span class="status-badge ').concat(n,'">').concat(o,"</span>\n      </h5>\n      ").concat(e.bloco?"<p><strong>Bloco:</strong> ".concat(e.bloco,"</p>"):"","\n      <p><strong>Área:</strong> ").concat(a,"</p>\n      <p><strong>Vértices:</strong> ").concat(e.coordinates.length,'</p>\n      <div class="lote-actions">\n        <button type="button" class="button button-small lote-action-zoom" data-lote-id="').concat(e.id,'">\n          <span class="dashicons dashicons-visibility"></span> Ver\n        </button>\n        <button type="button" class="button button-small lote-action-edit" data-lote-id="').concat(e.id,'">\n          <span class="dashicons dashicons-edit"></span> Editar\n        </button>\n        <button type="button" class="button button-small lote-action-delete" data-lote-id="').concat(e.id,'">\n          <span class="dashicons dashicons-trash"></span> Excluir\n        </button>\n      </div>\n    '),this.attachLoteActions(t,e.id),t}},{key:"attachLoteActions",value:function(e,t){var n=this,o=e.querySelector(".lote-action-zoom");o&&o.addEventListener("click",function(){n.eventBus.emit("ui:zoom_lote",{loteId:t})});var a=e.querySelector(".lote-action-edit");a&&a.addEventListener("click",function(){n.eventBus.emit("ui:edit_lote",{loteId:t})});var r=e.querySelector(".lote-action-delete");r&&r.addEventListener("click",function(){confirm("Tem certeza que deseja excluir este lote?")&&n.eventBus.emit("ui:delete_lote",{loteId:t})})}},{key:"updateLotesCounter",value:function(e){De.setText("total-lotes",e.toString())}},{key:"updateTotalArea",value:function(e){var t=Oe.formatArea(e);De.setText("area-total-value",t)}},{key:"calculateTotalArea",value:function(e){return e.reduce(function(e,t){return e+(t.area||0)},0)}},{key:"getStatusLabel",value:function(e){return{disponivel:"Disponível",vendido:"Vendido",reservado:"Reservado"}[e]||"Disponível"}},{key:"showNotification",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";"error"===t?alert("Erro: "+e):"success"===t?console.log("✓ "+e):console.log(e)}},{key:"toggleLoading",value:function(e){e&&console.log("Loading...")}}])}();function He(e){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(e)}function We(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,qe(o.key),o)}}function qe(e){var t=function(e){if("object"!=He(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=He(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==He(t)?t:t+""}var Ue=function(){return function(e,t){return t&&We(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=null,this.resolveCallback=null,this.rejectCallback=null,this.initialize()},[{key:"initialize",value:function(){var e=this;if(this.modal=document.getElementById("editModal"),this.modal){var t=this.modal.querySelector('button[onclick="saveEditLote()"]');t&&(t.removeAttribute("onclick"),t.addEventListener("click",function(){return e.handleSave()}));var n=this.modal.querySelector('button[onclick="closeEditModal()"]');n&&(n.removeAttribute("onclick"),n.addEventListener("click",function(){return e.handleCancel()})),this.modal.addEventListener("click",function(t){t.target===e.modal&&e.handleCancel()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.isOpen()&&e.handleCancel()})}else console.warn("Modal #editModal não encontrado no DOM")}},{key:"openEditModal",value:function(e){var t=this;return new Promise(function(n,o){t.resolveCallback=n,t.rejectCallback=o;var a=document.getElementById("editLoteUnidadeId"),r=document.getElementById("editLoteBloco"),i=document.getElementById("editLoteNome");a&&(a.value=e.id||""),r&&(r.value=e.bloco||""),i&&(i.value=e.nome||""),t.show(),a&&setTimeout(function(){return a.focus()},100)})}},{key:"handleSave",value:function(){var e=document.getElementById("editLoteUnidadeId"),t=document.getElementById("editLoteBloco"),n=document.getElementById("editLoteNome"),o={id:e?e.value.trim():"",bloco:t?t.value.trim():"",nome:n?n.value.trim():""};return o.id?o.bloco?(this.hide(),void(this.resolveCallback&&(this.resolveCallback(o),this.resolveCallback=null,this.rejectCallback=null))):(alert("Bloco é obrigatório"),void(t&&t.focus())):(alert("ID da Unidade é obrigatório"),void(e&&e.focus()))}},{key:"handleCancel",value:function(){this.hide(),this.rejectCallback&&(this.rejectCallback(new Error("Modal cancelado pelo usuário")),this.resolveCallback=null,this.rejectCallback=null)}},{key:"show",value:function(){this.modal&&(this.modal.style.display="block")}},{key:"hide",value:function(){this.modal&&(this.modal.style.display="none")}},{key:"isOpen",value:function(){return this.modal&&"block"===this.modal.style.display}},{key:"clear",value:function(){var e=document.getElementById("editLoteUnidadeId"),t=document.getElementById("editLoteBloco"),n=document.getElementById("editLoteNome");e&&(e.value=""),t&&(t.value=""),n&&(n.value="")}}])}();function Je(e){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Je(e)}function Ze(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Ye(o.key),o)}}function Ye(e){var t=function(e){if("object"!=Je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Je(t)?t:t+""}var Xe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id||this.generateId(),this.nome=t.nome||"",this.bloco=t.bloco||"",this.coordinates=t.coordinates||[],this.area=t.area||0,this.color=t.color||"",this.status=t.status||"disponivel",this.observacoes=t.observacoes||"",this.created_at=t.created_at||(new Date).toISOString(),this.updated_at=t.updated_at||(new Date).toISOString()}return function(e,t,n){return t&&Ze(e.prototype,t),n&&Ze(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"generateId",value:function(){return"lote_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}},{key:"validate",value:function(){var e=[];return this.id||e.push("ID é obrigatório"),(!Array.isArray(this.coordinates)||this.coordinates.length<3)&&e.push("Lote deve ter no mínimo 3 coordenadas"),this.coordinates.length>0&&this.coordinates.forEach(function(t,n){"number"==typeof t.lat&&"number"==typeof t.lng||e.push("Coordenada ".concat(n," inválida"))}),["disponivel","vendido","reservado"].includes(this.status)||e.push("Status inválido: ".concat(this.status)),{valid:0===e.length,errors:e}}},{key:"toJSON",value:function(){return{id:this.id,nome:this.nome,bloco:this.bloco,coordinates:this.coordinates,area:this.area,color:this.color,status:this.status,observacoes:this.observacoes,created_at:this.created_at,updated_at:this.updated_at}}},{key:"update",value:function(e){var t=this;Object.keys(e).forEach(function(n){"id"!==n&&"created_at"!==n&&(t[n]=e[n])}),this.updated_at=(new Date).toISOString()}},{key:"getFullName",value:function(){return this.bloco&&this.nome?"".concat(this.bloco," - ").concat(this.nome):this.nome||this.bloco||this.id}},{key:"getStatusLabel",value:function(){return{disponivel:"Disponível",vendido:"Vendido",reservado:"Reservado"}[this.status]||this.status}},{key:"isAvailable",value:function(){return"disponivel"===this.status}},{key:"markAsSold",value:function(){this.status="vendido",this.updated_at=(new Date).toISOString()}},{key:"markAsReserved",value:function(){this.status="reservado",this.updated_at=(new Date).toISOString()}},{key:"markAsAvailable",value:function(){this.status="disponivel",this.updated_at=(new Date).toISOString()}},{key:"clone",value:function(){return new e(this.toJSON())}}],[{key:"fromJSON",value:function(t){return"string"==typeof t&&(t=JSON.parse(t)),new e(t)}}])}();function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}function $e(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function r(n,o,a,r){var l=o&&o.prototype instanceof s?o:s,u=Object.create(l.prototype);return Ke(u,"_invoke",function(n,o,a){var r,s,l,u=0,c=a||[],d=!1,v={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return r=t,s=0,l=e,v.n=n,i}};function g(n,o){for(s=n,l=o,t=0;!d&&u&&!a&&t<c.length;t++){var a,r=c[t],g=v.p,p=r[2];n>3?(a=p===o)&&(l=r[(s=r[4])?5:(s=3,3)],r[4]=r[5]=e):r[0]<=g&&((a=n<2&&g<r[1])?(s=0,v.v=o,v.n=r[1]):g<p&&(a=n<3||r[0]>o||o>p)&&(r[4]=n,r[5]=o,v.n=p,s=0))}if(a||n>1)return i;throw d=!0,o}return function(a,c,p){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&g(c,p),s=c,l=p;(t=s<2?e:l)||!d;){r||(s?s<3?(s>1&&(v.n=-1),g(s,l)):v.n=l:v.v=l);try{if(u=2,r){if(s||(a="next"),t=r[a]){if(!(t=t.call(r,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=r.return)&&t.call(r),s<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),s=1);r=e}else if((t=(d=v.n<0)?l:n.call(o,v))!==i)break}catch(t){r=e,s=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,a,r),!0),u}var i={};function s(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][o]?t(t([][o]())):(Ke(t={},o,function(){return this}),t),d=u.prototype=s.prototype=Object.create(c);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Ke(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,Ke(d,"constructor",u),Ke(u,"constructor",l),l.displayName="GeneratorFunction",Ke(u,a,"GeneratorFunction"),Ke(d),Ke(d,a,"Generator"),Ke(d,o,function(){return this}),Ke(d,"toString",function(){return"[object Generator]"}),($e=function(){return{w:r,m:v}})()}function Ke(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}Ke=function(e,t,n,o){function r(t,n){Ke(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(r("next",0),r("throw",1),r("return",2))},Ke(e,t,n,o)}function et(e,t,n,o,a,r,i){try{var s=e[r](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,a)}function tt(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var r=e.apply(t,n);function i(e){et(r,o,a,i,s,"next",e)}function s(e){et(r,o,a,i,s,"throw",e)}i(void 0)})}}function nt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ot(o.key),o)}}function ot(e){var t=function(e){if("object"!=Qe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Qe(t)?t:t+""}var at=function(){return function(e,t){return t&&nt(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("🚀 Iniciando TerrenoMapApp..."),this.eventBus=new c,this.stateManager=new i,this.mapManager=null,this.drawingManager=null,this.polygonManager=null,this.geocodeManager=null,this.dataPersistence=null,this.uiManager=null,this.modalManager=null,this.svgImportManager=null,this.svgEditorManager=null,this.imageOverlayManager=null,this.infoWindow=null},[{key:"initialize",value:(o=tt($e().m(function e(){var t,n,o,a,r,i,s;return $e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=parseFloat(De.getValue("terreno_latitude"))||-3.7319,n=parseFloat(De.getValue("terreno_longitude"))||-38.5267,o=parseInt(De.getValue("terreno_zoom"))||18,this.mapManager=new m("gmap",this.stateManager,this.eventBus),e.n=1,this.mapManager.initialize(t,n,o);case 1:a=this.mapManager.getMap(),r=this.mapManager.getGeocoder(),this.drawingManager=new E(a,this.stateManager,this.eventBus),this.polygonManager=new L(a,this.stateManager,this.eventBus),this.geocodeManager=new A(r,this.eventBus),this.dataPersistence=new V("terreno_lotes_data",this.stateManager,this.eventBus),this.uiManager=new Ge(this.stateManager,this.eventBus),this.modalManager=new Ue,this.svgImportManager=new ee(a,this.stateManager,this.eventBus,this.polygonManager,this.dataPersistence),this.svgEditorManager=new ie(a,this.stateManager,this.eventBus),this.imageOverlayManager=new he(a,this.stateManager,this.eventBus),this.svgImportManager.loadSavedOverlay(),this.imageOverlayManager.loadSavedOverlay(),(i=this.dataPersistence.load()).length>0&&this.polygonManager.loadPolygons(i),this.uiManager.renderLotesList(i),this.setupEventHandlers(),this.setupDOMEventHandlers(),console.log("✓ TerrenoMapApp inicializado com sucesso"),console.log("📍 ".concat(i.length," lote(s) carregado(s)")),e.n=3;break;case 2:e.p=2,s=e.v,console.error("❌ Erro ao inicializar TerrenoMapApp:",s),alert("Erro ao inicializar o mapa. Verifique se a chave da API do Google Maps está configurada corretamente.");case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return o.apply(this,arguments)})},{key:"setupEventHandlers",value:function(){var e=this;this.eventBus.on("drawing:completed",function(e){e.polygon,e.coordinates,console.log("Desenho completado, aguardando aplicação...")}),this.eventBus.on("polygon:clicked",function(t){var n=t.lote,o=t.polygon,a=t.event;console.log("Polígono clicado:",n.nome||n.id),e.openInfoWindow(n,o,a)}),this.eventBus.on("ui:zoom_lote",function(t){var n=t.loteId;e.polygonManager.centerOnPolygon(n),e.polygonManager.highlightPolygon(n)}),this.eventBus.on("ui:edit_lote",function(t){var n=t.loteId;e.openEditModal(n)}),this.eventBus.on("ui:delete_lote",function(t){var n=t.loteId;e.deleteLote(n)}),this.eventBus.on("data:saved",function(){console.log("✓ Dados salvos com sucesso")}),this.eventBus.on("lotes:imported",function(t){var n=t.count;console.log("✓ ".concat(n," lotes importados do SVG")),e.uiManager.renderLotesList(e.stateManager.getState("lotesData"))}),this.eventBus.on("svg:shape_clicked",function(t){var n=t.index;console.log("Shape ".concat(n," clicado no overlay")),e.svgEditorManager&&(e.svgEditorManager.openEditor(),e.svgEditorManager.selectShape(n))}),this.eventBus.on("svg:configuration_saved",function(e){console.log("✓ Configuração SVG salva:",e)})}},{key:"setupDOMEventHandlers",value:function(){var e=this;De.addEventListener("desenhar_lote","click",function(){e.startDrawing()}),De.addEventListener("aplicar_desenho","click",function(){e.applyDrawing()}),De.addEventListener("cancelar_desenho","click",function(){e.cancelDrawing()}),De.addEventListener("limpar_lotes","click",function(){confirm("Tem certeza que deseja limpar TODOS os lotes? Esta ação não pode ser desfeita.")&&e.clearAllLotes()}),De.addEventListener("toggle_satellite","click",function(){var t="satellite"===e.mapManager.toggleMapType()?"Visualização Roadmap":"Visualização Satélite";De.setText("toggle_satellite",t)}),De.addEventListener("buscar_endereco","click",function(){e.searchAddress()}),De.addEventListener("ir_para_coordenadas","click",function(){e.goToCoordinates()}),this.eventBus.on("map:zoom_changed",function(e){De.setValue("terreno_zoom",e)}),this.eventBus.on("map:center_updated",function(e){var t=e.lat,n=e.lng;De.setValue("terreno_latitude",t.toFixed(7)),De.setValue("terreno_longitude",n.toFixed(7))})}},{key:"startDrawing",value:function(){this.drawingManager.startDrawing(),this.uiManager.updateDrawingButtons(!0)}},{key:"applyDrawing",value:(n=tt($e().m(function e(){var t,n,o,a,r,i,s,l,u;return $e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=this.drawingManager.getCurrentPolygon()){e.n=1;break}return alert("Nenhum polígono desenhado"),e.a(2);case 1:return n=Ee.pathToArray(t.getPath()),o=Oe.calculateAreaFromCoordinates(n),a=Re.random(),r="Lote ".concat(this.stateManager.getState("lotesData").length+1),i=new Xe({coordinates:n,area:o,color:a,nome:r,bloco:""}),e.p=2,e.n=3,this.modalManager.openEditModal(i);case 3:if(s=e.v,l=new Xe({id:s.id,coordinates:n,area:o,color:a,nome:s.nome||r,bloco:s.bloco}),(u=l.validate()).valid){e.n=4;break}return alert("Lote inválido: "+u.errors.join(", ")),e.a(2);case 4:t.setMap(null),this.dataPersistence.addLote(l.toJSON()),this.polygonManager.createPolygon(l.toJSON()),this.uiManager.renderLotesList(this.stateManager.getState("lotesData")),this.drawingManager.stopDrawing(),this.uiManager.updateDrawingButtons(!1),console.log("✓ Lote criado - ID:",l.id,"| Nome:",l.nome,"| Bloco:",l.bloco),e.n=6;break;case 5:e.p=5,e.v,t.setMap(null),this.drawingManager.stopDrawing(),this.uiManager.updateDrawingButtons(!1),console.log("Criação de lote cancelada");case 6:return e.a(2)}},e,this,[[2,5]])})),function(){return n.apply(this,arguments)})},{key:"cancelDrawing",value:function(){this.drawingManager.cancelDrawing(),this.uiManager.updateDrawingButtons(!1)}},{key:"clearAllLotes",value:function(){this.polygonManager.clearAllPolygons(),this.dataPersistence.clearAll(),this.uiManager.renderLotesList([]),console.log("✓ Todos os lotes foram removidos")}},{key:"deleteLote",value:function(e){this.polygonManager.deletePolygon(e),this.dataPersistence.removeLote(e),this.uiManager.renderLotesList(this.stateManager.getState("lotesData")),console.log("✓ Lote removido:",e)}},{key:"searchAddress",value:(t=tt($e().m(function e(){var t,n,o;return $e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=De.getValue("terreno_endereco")){e.n=1;break}return alert("Digite um endereço para buscar"),e.a(2);case 1:return e.p=1,e.n=2,this.geocodeManager.smartSearch(t);case 2:n=e.v,this.mapManager.updateCenter(n.lat,n.lng),this.mapManager.updateZoom(18),De.setValue("terreno_latitude",n.lat.toFixed(7)),De.setValue("terreno_longitude",n.lng.toFixed(7)),n.address&&De.setValue("terreno_endereco",n.address),console.log("✓ Endereço encontrado:",n.address||t),e.n=4;break;case 3:e.p=3,o=e.v,alert("Erro ao buscar endereço: "+o.message);case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return t.apply(this,arguments)})},{key:"goToCoordinates",value:function(){var e=parseFloat(De.getValue("terreno_latitude")),t=parseFloat(De.getValue("terreno_longitude")),n=parseInt(De.getValue("terreno_zoom"))||18;isNaN(e)||isNaN(t)?alert("Por favor, digite coordenadas válidas de latitude e longitude."):e<-90||e>90?alert("Latitude deve estar entre -90 e 90."):t<-180||t>180?alert("Longitude deve estar entre -180 e 180."):(this.mapManager.updateCenter(e,t),this.mapManager.updateZoom(n),console.log("✓ Mapa movido para: ".concat(e,", ").concat(t," (zoom: ").concat(n,")")))}},{key:"openEditModal",value:(e=tt($e().m(function e(t){var n,o,a;return $e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=this.stateManager.getLote(t)){e.n=1;break}return alert("Lote não encontrado"),e.a(2);case 1:return e.p=1,e.n=2,this.modalManager.openEditModal(n);case 2:(o=e.v).id!==t?(this.polygonManager.deletePolygon(t),this.dataPersistence.removeLote(t),a=new Xe({id:o.id,coordinates:n.coordinates,area:n.area,color:n.color,nome:o.nome||n.nome,bloco:o.bloco,status:n.status,observacoes:n.observacoes,created_at:n.created_at}),this.dataPersistence.addLote(a.toJSON()),this.polygonManager.createPolygon(a.toJSON()),console.log("✓ Lote recriado com novo ID - Antigo:",t,"| Novo:",o.id)):(this.dataPersistence.updateLote(t,{nome:o.nome||n.nome,bloco:o.bloco||n.bloco}),console.log("✓ Lote atualizado:",t)),this.uiManager.renderLotesList(this.stateManager.getState("lotesData")),e.n=4;break;case 3:e.p=3,e.v,console.log("Edição cancelada");case 4:return e.a(2)}},e,this,[[1,3]])})),function(t){return e.apply(this,arguments)})},{key:"openInfoWindow",value:function(e,t,n){var o=this;this.infoWindow&&this.infoWindow.close();var a='\n      <div style="padding: 10px; min-width: 200px;">\n        <h4 style="margin: 0 0 10px 0; color: #23282d; font-size: 14px;">\n          '.concat(e.nome||"Lote sem nome",'\n        </h4>\n        <p style="margin: 5px 0; font-size: 13px; color: #666;">\n          <strong>ID da Unidade:</strong> ').concat(e.id||"-",'\n        </p>\n        <p style="margin: 5px 0; font-size: 13px; color: #666;">\n          <strong>Quadra:</strong> ').concat(e.bloco||"-",'\n        </p>\n        <p style="margin: 5px 0; font-size: 13px; color: #666;">\n          <strong>Área:</strong> ').concat(e.area?e.area.toFixed(2)+" m²":"-",'\n        </p>\n        <div style="margin-top: 12px; text-align: center;">\n          <button type="button" class="button button-primary" id="infowindow-edit-btn" style="width: 100%;">\n            Editar Lote\n          </button>\n        </div>\n      </div>\n    ');this.infoWindow=new google.maps.InfoWindow({content:a,position:n.latLng}),this.infoWindow.open(this.mapManager.getMap()),google.maps.event.addListenerOnce(this.infoWindow,"domready",function(){var t=document.getElementById("infowindow-edit-btn");t&&t.addEventListener("click",function(){o.infoWindow.close(),o.openEditModal(e.id)})})}}]);var e,t,n,o}();jQuery(document).ready(function(){if(0!==jQuery("#gmap").length){var e=new at;e.initialize(),window.TerrenoMapApp=e}else console.log("Elemento #gmap não encontrado, não iniciando TerrenoMapApp")}),window.TerrenoMapApp={}})();
//# sourceMappingURL=terreno-admin.bundle.js.map