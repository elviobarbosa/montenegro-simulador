/*! For license information please see terreno-admin.bundle.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function n(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach(function(t){o(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function o(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,a(o.key),o)}}function a(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var i=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state={map:null,drawingManager:null,polygons:new Map,lotesData:[],isDrawingMode:!1,currentMapType:"roadmap",currentPolygon:null,currentInfoWindow:null,currentEditLoteId:null,zoom:18,center:{lat:-3.7319,lng:-38.5267}},this.subscribers=new Map},(t=[{key:"setState",value:function(e,t){var n=this.state[e];this.state[e]=t,n!==t&&this.notifySubscribers(e,t,n)}},{key:"getState",value:function(e){return this.state[e]}},{key:"getAllState",value:function(){return n({},this.state)}},{key:"subscribe",value:function(e,t){this.subscribers.has(e)||this.subscribers.set(e,[]),this.subscribers.get(e).push(t)}},{key:"unsubscribe",value:function(e,t){if(this.subscribers.has(e)){var n=this.subscribers.get(e),o=n.indexOf(t);o>-1&&n.splice(o,1)}}},{key:"notifySubscribers",value:function(e,t,n){this.subscribers.has(e)&&this.subscribers.get(e).forEach(function(o){try{o(t,n)}catch(t){console.error('Erro ao executar subscriber da chave "'.concat(e,'":'),t)}})}},{key:"setMultiple",value:function(e){var t=this;Object.keys(e).forEach(function(n){t.setState(n,e[n])})}},{key:"reset",value:function(){this.state={map:null,drawingManager:null,polygons:new Map,lotesData:[],isDrawingMode:!1,currentMapType:"roadmap",currentPolygon:null,currentInfoWindow:null,currentEditLoteId:null,zoom:18,center:{lat:-3.7319,lng:-38.5267}}}},{key:"addPolygon",value:function(e,t){this.state.polygons.set(e,t)}},{key:"removePolygon",value:function(e){this.state.polygons.delete(e)}},{key:"getPolygon",value:function(e){return this.state.polygons.get(e)}},{key:"addLote",value:function(e){this.state.lotesData.push(e)}},{key:"updateLote",value:function(e,t){var o=this.state.lotesData.findIndex(function(t){return t.id===e});o>-1&&(this.state.lotesData[o]=n(n({},this.state.lotesData[o]),t))}},{key:"removeLote",value:function(e){this.state.lotesData=this.state.lotesData.filter(function(t){return t.id!==e})}},{key:"getLote",value:function(e){return this.state.lotesData.find(function(t){return t.id===e})}}])&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,u(o.key),o)}}function u(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}var c=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events=new Map},t=[{key:"on",value:function(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}},{key:"off",value:function(e,t){if(this.events.has(e)){var n=this.events.get(e),o=n.indexOf(t);o>-1&&n.splice(o,1),0===n.length&&this.events.delete(e)}}},{key:"emit",value:function(e,t){this.events.has(e)&&this.events.get(e).forEach(function(n){try{n(t)}catch(t){console.error('Erro ao executar callback do evento "'.concat(e,'":'),t)}})}},{key:"once",value:function(e,t){var n=this,o=function(r){t(r),n.off(e,o)};this.on(e,o)}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?this.events.delete(e):this.events.clear()}},{key:"listenerCount",value:function(e){return this.events.has(e)?this.events.get(e).length:0}}],t&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,o,r,a){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return g(u,"_invoke",function(n,o,r){var a,l,s,u=0,c=r||[],f=!1,d={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,l=0,s=e,d.n=n,i}};function g(n,o){for(l=n,s=o,t=0;!f&&u&&!r&&t<c.length;t++){var r,a=c[t],g=d.p,v=a[2];n>3?(r=v===o)&&(s=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=g&&((r=n<2&&g<a[1])?(l=0,d.v=o,d.n=a[1]):g<v&&(r=n<3||a[0]>o||o>v)&&(a[4]=n,a[5]=o,d.n=v,l=0))}if(r||n>1)return i;throw f=!0,o}return function(r,c,v){if(u>1)throw TypeError("Generator is already running");for(f&&1===c&&g(c,v),l=c,s=v;(t=l<2?e:s)||!f;){a||(l?l<3?(l>1&&(d.n=-1),g(l,s)):d.n=s:d.v=s);try{if(u=2,a){if(l||(r="next"),t=a[r]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=e}else if((t=(f=d.n<0)?s:n.call(o,d))!==i)break}catch(t){a=e,l=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,r,a),!0),u}var i={};function l(){}function s(){}function u(){}t=Object.getPrototypeOf;var c=[][o]?t(t([][o]())):(g(t={},o,function(){return this}),t),f=u.prototype=l.prototype=Object.create(c);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,g(e,r,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,g(f,"constructor",u),g(u,"constructor",s),s.displayName="GeneratorFunction",g(u,r,"GeneratorFunction"),g(f),g(f,r,"Generator"),g(f,o,function(){return this}),g(f,"toString",function(){return"[object Generator]"}),(d=function(){return{w:a,m:v}})()}function g(e,t,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}g=function(e,t,n,o){function a(t,n){g(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},g(e,t,n,o)}function v(e,t,n,o,r,a,i){try{var l=e[a](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(o,r)}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,y(o.key),o)}}function y(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}var h=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elementId=t,this.stateManager=n,this.eventBus=o,this.map=null,this.geocoder=null},t=[{key:"initialize",value:(n=d().m(function e(t,n,o){var r,a;return d().w(function(e){for(;;)switch(e.n){case 0:if(r=document.getElementById(this.elementId)){e.n=1;break}throw new Error('Elemento com ID "'.concat(this.elementId,'" não encontrado'));case 1:if("undefined"!=typeof google&&void 0!==google.maps){e.n=2;break}throw new Error("Google Maps API não está carregada");case 2:return a={center:{lat:t,lng:n},zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!0,zoomControl:!0,gestureHandling:"greedy"},this.map=new google.maps.Map(r,a),this.geocoder=new google.maps.Geocoder,this.stateManager.setState("map",this.map),this.stateManager.setMultiple({center:{lat:t,lng:n},zoom:o,currentMapType:"roadmap"}),this.setupMapEventListeners(),this.eventBus.emit("map:initialized",{lat:t,lng:n,zoom:o}),e.a(2,this.map)}},e,this)}),o=function(){var e=this,t=arguments;return new Promise(function(o,r){var a=n.apply(e,t);function i(e){v(a,o,r,i,l,"next",e)}function l(e){v(a,o,r,i,l,"throw",e)}i(void 0)})},function(e,t,n){return o.apply(this,arguments)})},{key:"setupMapEventListeners",value:function(){var e=this;google.maps.event.addListener(this.map,"zoom_changed",function(){var t=e.map.getZoom();e.stateManager.setState("zoom",t),e.eventBus.emit("map:zoom_changed",t)}),google.maps.event.addListener(this.map,"center_changed",function(){var t=e.map.getCenter(),n={lat:t.lat(),lng:t.lng()};e.stateManager.setState("center",n)}),google.maps.event.addListener(this.map,"click",function(){e.eventBus.emit("map:clicked")})}},{key:"getMap",value:function(){return this.map}},{key:"getGeocoder",value:function(){return this.geocoder}},{key:"updateCenter",value:function(e,t){if(this.map){var n=new google.maps.LatLng(e,t);this.map.setCenter(n),this.stateManager.setState("center",{lat:e,lng:t}),this.eventBus.emit("map:center_updated",{lat:e,lng:t})}else console.warn("Mapa não inicializado")}},{key:"updateZoom",value:function(e){if(this.map){var t=Math.max(1,Math.min(20,e));this.map.setZoom(t),this.stateManager.setState("zoom",t)}else console.warn("Mapa não inicializado")}},{key:"toggleMapType",value:function(){if(this.map){var e="roadmap"===this.stateManager.getState("currentMapType")?"satellite":"roadmap";return this.map.setMapTypeId("satellite"===e?google.maps.MapTypeId.SATELLITE:google.maps.MapTypeId.ROADMAP),this.stateManager.setState("currentMapType",e),this.eventBus.emit("map:type_changed",e),e}console.warn("Mapa não inicializado")}},{key:"fitBounds",value:function(e){if(this.map&&e&&0!==e.length){var t=new google.maps.LatLngBounds;e.forEach(function(e){e.getPath().forEach(function(e){t.extend(e)})}),this.map.fitBounds(t)}}},{key:"fitToBounds",value:function(e){this.map&&this.map.fitBounds(e)}},{key:"panTo",value:function(e,t){if(this.map){var n=new google.maps.LatLng(e,t);this.map.panTo(n)}}},{key:"clearOverlays",value:function(){this.eventBus.emit("map:overlays_cleared")}},{key:"destroy",value:function(){this.map&&(google.maps.event.clearInstanceListeners(this.map),this.map=null,this.geocoder=null,this.stateManager.setState("map",null),this.eventBus.emit("map:destroyed"))}}],t&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o}();function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,w(o.key),o)}}function w(e){var t=function(e){if("object"!=m(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}var k=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.stateManager=n,this.eventBus=o,this.drawingManager=null,this.currentPolygon=null},(t=[{key:"initialize",value:function(){var e=this;this.drawingManager||(this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,polygonOptions:{strokeColor:"#FF6B6B",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF6B6B",fillOpacity:.35,editable:!0,draggable:!1}}),this.drawingManager.setMap(this.map),this.stateManager.setState("drawingManager",this.drawingManager),google.maps.event.addListener(this.drawingManager,"overlaycomplete",function(t){t.type===google.maps.drawing.OverlayType.POLYGON&&e.handlePolygonComplete(t.overlay)}),console.log("DrawingManager inicializado"))}},{key:"startDrawing",value:function(){this.drawingManager||this.initialize(),this.currentPolygon&&this.cancelDrawing(),this.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),this.stateManager.setState("isDrawingMode",!0),this.eventBus.emit("drawing:started"),console.log("Modo de desenho ativado")}},{key:"stopDrawing",value:function(){if(!this.drawingManager)return null;this.drawingManager.setDrawingMode(null),this.stateManager.setState("isDrawingMode",!1);var e=this.currentPolygon;return this.currentPolygon=null,this.eventBus.emit("drawing:stopped",{polygon:e}),console.log("Modo de desenho desativado"),e}},{key:"cancelDrawing",value:function(){this.currentPolygon&&(this.currentPolygon.setMap(null),this.currentPolygon=null),this.drawingManager&&this.drawingManager.setDrawingMode(null),this.stateManager.setState("isDrawingMode",!1),this.stateManager.setState("currentPolygon",null),this.eventBus.emit("drawing:canceled"),console.log("Desenho cancelado")}},{key:"handlePolygonComplete",value:function(e){if(this.drawingManager.setDrawingMode(null),!this.validatePolygon(e))return e.setMap(null),void this.eventBus.emit("drawing:invalid");this.currentPolygon=e,this.stateManager.setState("currentPolygon",e);var t=this.extractCoordinates(e);this.eventBus.emit("drawing:completed",{polygon:e,coordinates:t}),console.log("Polígono desenhado com sucesso",{vertices:t.length})}},{key:"validatePolygon",value:function(e){return!(e.getPath().getLength()<3&&(alert("O polígono deve ter pelo menos 3 vértices"),1))}},{key:"extractCoordinates",value:function(e){for(var t=e.getPath(),n=[],o=0;o<t.getLength();o++){var r=t.getAt(o);n.push({lat:r.lat(),lng:r.lng()})}return n}},{key:"getCurrentPolygon",value:function(){return this.currentPolygon}},{key:"isDrawing",value:function(){return this.stateManager.getState("isDrawingMode")}},{key:"setPolygonOptions",value:function(e){this.drawingManager&&this.drawingManager.setOptions({polygonOptions:e})}},{key:"destroy",value:function(){this.currentPolygon&&(this.currentPolygon.setMap(null),this.currentPolygon=null),this.drawingManager&&(google.maps.event.clearInstanceListeners(this.drawingManager),this.drawingManager.setMap(null),this.drawingManager=null),this.stateManager.setState("drawingManager",null),this.stateManager.setState("isDrawingMode",!1),this.stateManager.setState("currentPolygon",null),console.log("DrawingManager destruído")}}])&&b(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,P(o.key),o)}}function P(e){var t=function(e){if("object"!=M(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==M(t)?t:t+""}var E=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.stateManager=n,this.eventBus=o},(t=[{key:"createPolygon",value:function(e){if(!e.coordinates||e.coordinates.length<3)return console.error("Lote deve ter no mínimo 3 coordenadas"),null;var t=e.coordinates.map(function(e){return{lat:e.lat,lng:e.lng}}),n=e.color||this.generateRandomColor(),o=new google.maps.Polygon({paths:t,strokeColor:n,strokeOpacity:.8,strokeWeight:2,fillColor:n,fillOpacity:.35,editable:!1,draggable:!1,map:this.map});return o.loteId=e.id,o.loteData=e,this.stateManager.addPolygon(e.id,o),this.setupPolygonEvents(o,e),o}},{key:"setupPolygonEvents",value:function(e,t){var n=this;google.maps.event.addListener(e,"click",function(o){n.eventBus.emit("polygon:clicked",{lote:t,polygon:e,event:o})}),google.maps.event.addListener(e,"mouseover",function(){e.setOptions({strokeWeight:3,fillOpacity:.5}),n.eventBus.emit("polygon:hover",{lote:t,polygon:e})}),google.maps.event.addListener(e,"mouseout",function(){e.setOptions({strokeWeight:2,fillOpacity:.35})}),google.maps.event.addListener(e,"rightclick",function(o){n.eventBus.emit("polygon:rightclick",{lote:t,polygon:e,event:o})})}},{key:"updatePolygon",value:function(e,t){var n=this.stateManager.getPolygon(e);if(!n)return console.warn('Polígono com ID "'.concat(e,'" não encontrado')),!1;var o=t.map(function(e){return{lat:e.lat,lng:e.lng}});return n.setPath(o),this.eventBus.emit("polygon:updated",{loteId:e,coordinates:t}),!0}},{key:"enableEditing",value:function(e){var t=this,n=this.stateManager.getPolygon(e);if(n){n.setOptions({editable:!0,draggable:!0});var o=google.maps.event.addListener(n.getPath(),"set_at",function(){t.handlePolygonEdit(n)}),r=google.maps.event.addListener(n.getPath(),"insert_at",function(){t.handlePolygonEdit(n)});n.editListeners=[o,r]}else console.warn('Polígono com ID "'.concat(e,'" não encontrado'))}},{key:"disableEditing",value:function(e){var t=this.stateManager.getPolygon(e);t&&(t.setOptions({editable:!1,draggable:!1}),t.editListeners&&(t.editListeners.forEach(function(e){google.maps.event.removeListener(e)}),t.editListeners=null))}},{key:"handlePolygonEdit",value:function(e){for(var t=e.getPath(),n=[],o=0;o<t.getLength();o++){var r=t.getAt(o);n.push({lat:r.lat(),lng:r.lng()})}this.eventBus.emit("polygon:path_changed",{loteId:e.loteId,coordinates:n})}},{key:"deletePolygon",value:function(e){var t=this.stateManager.getPolygon(e);return t?(t.editListeners&&t.editListeners.forEach(function(e){google.maps.event.removeListener(e)}),google.maps.event.clearInstanceListeners(t),t.setMap(null),this.stateManager.removePolygon(e),this.eventBus.emit("polygon:deleted",{loteId:e}),!0):(console.warn('Polígono com ID "'.concat(e,'" não encontrado')),!1)}},{key:"loadPolygons",value:function(e){var t=this,n=[];return e.forEach(function(e){var o=t.createPolygon(e);o&&n.push(o)}),console.log("".concat(n.length," polígono(s) carregado(s) no mapa")),this.eventBus.emit("polygons:loaded",n),n}},{key:"clearAllPolygons",value:function(){var e=this.stateManager.getState("polygons");e.forEach(function(e,t){google.maps.event.clearInstanceListeners(e),e.setMap(null)}),e.clear(),this.eventBus.emit("polygons:cleared"),console.log("Todos os polígonos foram removidos")}},{key:"highlightPolygon",value:function(e){var t=this.stateManager.getPolygon(e);if(t){var n={strokeWeight:t.strokeWeight,strokeOpacity:t.strokeOpacity,fillOpacity:t.fillOpacity};t.setOptions({strokeWeight:4,strokeOpacity:1,fillOpacity:.6}),setTimeout(function(){t.setOptions(n)},2e3)}}},{key:"generateRandomColor",value:function(){var e=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F06292","#AED581","#FFD54F","#4DB6AC","#7986CB"];return e[Math.floor(Math.random()*e.length)]}},{key:"getAllPolygons",value:function(){return this.stateManager.getState("polygons")}},{key:"centerOnPolygon",value:function(e){var t=this.stateManager.getPolygon(e);if(t){var n=new google.maps.LatLngBounds;t.getPath().forEach(function(e){n.extend(e)}),this.map.fitBounds(n),this.map.setZoom(Math.min(this.map.getZoom(),18))}}}])&&S(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach(function(t){D(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function D(e,t,n){return(t=_(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,o,r,a){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return A(u,"_invoke",function(n,o,r){var a,l,s,u=0,c=r||[],f=!1,d={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,l=0,s=e,d.n=n,i}};function g(n,o){for(l=n,s=o,t=0;!f&&u&&!r&&t<c.length;t++){var r,a=c[t],g=d.p,v=a[2];n>3?(r=v===o)&&(s=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=g&&((r=n<2&&g<a[1])?(l=0,d.v=o,d.n=a[1]):g<v&&(r=n<3||a[0]>o||o>v)&&(a[4]=n,a[5]=o,d.n=v,l=0))}if(r||n>1)return i;throw f=!0,o}return function(r,c,v){if(u>1)throw TypeError("Generator is already running");for(f&&1===c&&g(c,v),l=c,s=v;(t=l<2?e:s)||!f;){a||(l?l<3?(l>1&&(d.n=-1),g(l,s)):d.n=s:d.v=s);try{if(u=2,a){if(l||(r="next"),t=a[r]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=e}else if((t=(f=d.n<0)?s:n.call(o,d))!==i)break}catch(t){a=e,l=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,r,a),!0),u}var i={};function l(){}function s(){}function u(){}t=Object.getPrototypeOf;var c=[][o]?t(t([][o]())):(A(t={},o,function(){return this}),t),f=u.prototype=l.prototype=Object.create(c);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,A(e,r,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,A(f,"constructor",u),A(u,"constructor",s),s.displayName="GeneratorFunction",A(u,r,"GeneratorFunction"),A(f),A(f,r,"Generator"),A(f,o,function(){return this}),A(f,"toString",function(){return"[object Generator]"}),(T=function(){return{w:a,m:d}})()}function A(e,t,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}A=function(e,t,n,o){function a(t,n){A(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},A(e,t,n,o)}function C(e,t,n,o,r,a,i){try{var l=e[a](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(o,r)}function B(e){return function(){var t=this,n=arguments;return new Promise(function(o,r){var a=e.apply(t,n);function i(e){C(a,o,r,i,l,"next",e)}function l(e){C(a,o,r,i,l,"throw",e)}i(void 0)})}}function I(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_(o.key),o)}}function _(e){var t=function(e){if("object"!=O(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==O(t)?t:t+""}var F=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.geocoder=t,this.eventBus=n},t=[{key:"searchAddress",value:(l=B(T().m(function e(t){var n=this;return T().w(function(e){for(;;)switch(e.n){case 0:if(t&&""!==t.trim()){e.n=1;break}throw new Error("Endereço não pode ser vazio");case 1:return e.a(2,new Promise(function(e,o){n.geocoder.geocode({address:t},function(r,a){if(a===google.maps.GeocoderStatus.OK&&r[0]){var i=r[0].geometry.location,l={lat:i.lat(),lng:i.lng(),formatted_address:r[0].formatted_address,place_id:r[0].place_id};n.eventBus.emit("geocode:success",l),console.log("Endereço encontrado:",l.formatted_address),e(l)}else{var s=new Error("Geocode falhou: ".concat(a));n.eventBus.emit("geocode:error",{address:t,status:a}),console.error("Erro ao buscar endereço:",a),o(s)}})}))}},e)})),function(e){return l.apply(this,arguments)})},{key:"reverseGeocode",value:(i=B(T().m(function e(t,n){var o,r=this;return T().w(function(e){for(;;)if(0===e.n)return o=new google.maps.LatLng(t,n),e.a(2,new Promise(function(e,a){r.geocoder.geocode({location:o},function(o,i){if(i===google.maps.GeocoderStatus.OK&&o[0]){var l=o[0].formatted_address;r.eventBus.emit("reverse_geocode:success",{lat:t,lng:n,address:l}),console.log("Endereço encontrado:",l),e(l)}else{var s=new Error("Reverse geocode falhou: ".concat(i));r.eventBus.emit("reverse_geocode:error",{lat:t,lng:n,status:i}),a(s)}})}))},e)})),function(e,t){return i.apply(this,arguments)})},{key:"searchCoordinates",value:(a=B(T().m(function e(t){var n,o,r,a;return T().w(function(e){for(;;)switch(e.n){case 0:if(2===(n=t.split(",").map(function(e){return e.trim()})).length){e.n=1;break}throw new Error("Formato inválido. Use: latitude, longitude");case 1:if(o=parseFloat(n[0]),r=parseFloat(n[1]),!isNaN(o)&&!isNaN(r)){e.n=2;break}throw new Error("Coordenadas inválidas");case 2:if(!(o<-90||o>90||r<-180||r>180)){e.n=3;break}throw new Error("Coordenadas fora dos limites válidos");case 3:return a={lat:o,lng:r},this.eventBus.emit("coordinates:searched",a),console.log("Coordenadas processadas:",a),e.a(2,a)}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getCurrentLocation",value:(r=B(T().m(function e(){var t=this;return T().w(function(e){for(;;)switch(e.n){case 0:if(navigator.geolocation){e.n=1;break}throw new Error("Geolocalização não é suportada por este navegador");case 1:return e.a(2,new Promise(function(e,n){navigator.geolocation.getCurrentPosition(function(n){var o={lat:n.coords.latitude,lng:n.coords.longitude,accuracy:n.coords.accuracy};t.eventBus.emit("geolocation:success",o),console.log("Localização atual obtida:",o),e(o)},function(e){var o="Erro ao obter localização";switch(e.code){case e.PERMISSION_DENIED:o="Permissão de localização negada";break;case e.POSITION_UNAVAILABLE:o="Localização indisponível";break;case e.TIMEOUT:o="Timeout ao obter localização"}t.eventBus.emit("geolocation:error",{code:e.code,message:o}),console.error(o,e),n(new Error(o))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}))}},e)})),function(){return r.apply(this,arguments)})},{key:"getPlaceDetails",value:(o=B(T().m(function e(t){var n=this;return T().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,o){n.geocoder.geocode({placeId:t},function(r,a){if(a===google.maps.GeocoderStatus.OK&&r[0]){var i=r[0].geometry.location,l={lat:i.lat(),lng:i.lng(),formatted_address:r[0].formatted_address,place_id:r[0].place_id,types:r[0].types};n.eventBus.emit("place_details:success",l),e(l)}else{var s=new Error("Place details falhou: ".concat(a));n.eventBus.emit("place_details:error",{placeId:t,status:a}),o(s)}})}))},e)})),function(e){return o.apply(this,arguments)})},{key:"validateInput",value:function(e){return e&&""!==e.trim()?(e=e.trim(),/^-?\d+\.?\d*\s*,\s*-?\d+\.?\d*$/.test(e)?{type:"coordinates",valid:!0}:{type:"address",valid:!0}):{type:null,valid:!1}}},{key:"smartSearch",value:(n=B(T().m(function e(t){var n,o,r,a;return T().w(function(e){for(;;)switch(e.n){case 0:if((n=this.validateInput(t)).valid){e.n=1;break}throw new Error("Entrada inválida");case 1:if("coordinates"!==n.type){e.n=4;break}return e.n=2,this.searchCoordinates(t);case 2:return o=e.v,e.n=3,this.reverseGeocode(o.lat,o.lng);case 3:return r=e.v,e.a(2,j(j({},o),{},{address:r}));case 4:return e.n=5,this.searchAddress(t);case 5:return a=e.v,e.a(2,{lat:a.lat,lng:a.lng,address:a.formatted_address});case 6:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})}],t&&I(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,r,a,i,l}();function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,G(o.key),o)}}function G(e){var t=function(e){if("object"!=z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==z(t)?t:t+""}var V=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fieldId=t,this.stateManager=n,this.eventBus=o,this.field=null},(t=[{key:"initialize",value:function(){return this.field=document.getElementById(this.fieldId),!!this.field||(console.error('Campo hidden com ID "'.concat(this.fieldId,'" não encontrado')),!1)}},{key:"load",value:function(){var e=this;if(!this.initialize())return[];var t=this.field.value;if(!t||""===t.trim())return console.log("Nenhum dado de lotes encontrado"),[];try{var n=JSON.parse(t);if(!Array.isArray(n))return console.error("Dados de lotes inválidos: esperado array"),[];var o=n.filter(function(t){return e.validateLote(t)});return this.stateManager.setState("lotesData",o),console.log("".concat(o.length," lote(s) carregado(s)")),this.eventBus.emit("data:loaded",o),o}catch(e){return console.error("Erro ao fazer parse dos dados de lotes:",e),console.error("Dados problemáticos:",t.substring(0,200)),[]}}},{key:"save",value:function(){if(!this.initialize())return!1;var e=this.stateManager.getState("lotesData");try{var t=JSON.stringify(e);return this.field.value=t,console.log("".concat(e.length," lote(s) salvo(s)")),this.eventBus.emit("data:saved",e),!0}catch(e){return console.error("Erro ao serializar dados de lotes:",e),!1}}},{key:"validateLote",value:function(e){if(!e||"object"!==z(e))return console.warn("Lote inválido: não é um objeto",e),!1;for(var t=0,n=["id","coordinates"];t<n.length;t++){var o=n[t];if(!(o in e))return console.warn('Lote inválido: campo "'.concat(o,'" ausente'),e),!1}if(!Array.isArray(e.coordinates)||e.coordinates.length<3)return console.warn("Lote inválido: coordinates deve ser array com no mínimo 3 pontos",e),!1;var r,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return x(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(e.coordinates);try{for(a.s();!(r=a.n()).done;){var i=r.value;if("number"!=typeof i.lat||"number"!=typeof i.lng)return console.warn("Lote inválido: coordenada com lat/lng inválido",i),!1}}catch(e){a.e(e)}finally{a.f()}return!0}},{key:"addLote",value:function(e){return this.validateLote(e)?(this.stateManager.addLote(e),this.save()):(console.error("Lote inválido, não será adicionado"),!1)}},{key:"updateLote",value:function(e,t){return this.stateManager.updateLote(e,t),this.save()}},{key:"removeLote",value:function(e){return this.stateManager.removeLote(e),this.save()}},{key:"clearAll",value:function(){return this.stateManager.setState("lotesData",[]),this.save()}},{key:"exportJSON",value:function(){var e=this.stateManager.getState("lotesData");return JSON.stringify(e,null,2)}},{key:"importJSON",value:function(e){var t=this;try{var n=JSON.parse(e);if(!Array.isArray(n))throw new Error("Dados devem ser um array");var o=n.filter(function(e){return t.validateLote(e)});return this.stateManager.setState("lotesData",o),this.save()}catch(e){return console.error("Erro ao importar JSON:",e),!1}}}])&&N(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function J(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,R(o.key),o)}}function R(e){var t=function(e){if("object"!=H(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==H(t)?t:t+""}var q=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"pathToArray",value:function(e){for(var t=[],n=0;n<e.getLength();n++){var o=e.getAt(n);t.push({lat:o.lat(),lng:o.lng()})}return t}},{key:"arrayToLatLngArray",value:function(e){return e.map(function(e){return new google.maps.LatLng(e.lat,e.lng)})}},{key:"validateCoordinates",value:function(e,t){return!("number"!=typeof e||"number"!=typeof t||isNaN(e)||isNaN(t)||e<-90||e>90||t<-180||t>180)}},{key:"getPolygonCenter",value:function(e){if(!e||0===e.length)return null;var t=0,n=0;return e.forEach(function(e){t+=e.lat,n+=e.lng}),{lat:t/e.length,lng:n/e.length}}},{key:"getBounds",value:function(e){if(!e||0===e.length)return null;var t=new google.maps.LatLngBounds;return e.forEach(function(e){t.extend(new google.maps.LatLng(e.lat,e.lng))}),t}},{key:"formatCoordinates",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;return"".concat(e.toFixed(n),", ").concat(t.toFixed(n))}},{key:"calculateDistance",value:function(e,t){var n=e.lat*Math.PI/180,o=t.lat*Math.PI/180,r=(t.lat-e.lat)*Math.PI/180,a=(t.lng-e.lng)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}},{key:"simplifyPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e.length<=3)return e;for(var n=[e[0]],o=1;o<e.length-1;o++)this.calculateDistance(n[n.length-1],e[o])>=t&&n.push(e[o]);return n.push(e[e.length-1]),n}},{key:"isPointInPolygon",value:function(e,t){var n=new google.maps.LatLng(e.lat,e.lng),o=new google.maps.Polygon({paths:t});return google.maps.geometry.poly.containsLocation(n,o)}}],null&&J(e.prototype,null),t&&J(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function W(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Z(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function $(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,K(o.key),o)}}function K(e){var t=function(e){if("object"!=U(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==U(t)?t:t+""}var Q=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"calculateArea",value:function(e){if(!e||!e.getPath)return console.error("Polígono inválido para cálculo de área"),0;var t=google.maps.geometry.spherical.computeArea(e.getPath());return Math.round(100*t)/100}},{key:"calculateAreaFromCoordinates",value:function(e){if(!e||e.length<3)return 0;var t=e.map(function(e){return new google.maps.LatLng(e.lat,e.lng)}),n=google.maps.geometry.spherical.computeArea(t);return Math.round(100*n)/100}},{key:"formatArea",value:function(e){if("number"!=typeof e||isNaN(e))return"0 m²";var t=e.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});return"".concat(t," m²")}},{key:"toHectares",value:function(e){return e/1e4}},{key:"formatAsHectares",value:function(e){var t=this.toHectares(e).toLocaleString("pt-BR",{minimumFractionDigits:4,maximumFractionDigits:4});return"".concat(t," ha")}},{key:"formatSmart",value:function(e){return e>=1e4?this.formatAsHectares(e):this.formatArea(e)}},{key:"calculatePerimeter",value:function(e){if(!e||!e.getPath)return 0;for(var t=e.getPath(),n=0,o=0;o<t.getLength();o++){var r=t.getAt(o),a=t.getAt((o+1)%t.getLength());n+=google.maps.geometry.spherical.computeDistanceBetween(r,a)}return Math.round(100*n)/100}},{key:"calculatePerimeterFromCoordinates",value:function(e){if(!e||e.length<3)return 0;for(var t=0,n=0;n<e.length;n++){var o=new google.maps.LatLng(e[n].lat,e[n].lng),r=new google.maps.LatLng(e[(n+1)%e.length].lat,e[(n+1)%e.length].lng);t+=google.maps.geometry.spherical.computeDistanceBetween(o,r)}return Math.round(100*t)/100}},{key:"formatPerimeter",value:function(e){return"number"!=typeof e||isNaN(e)?"0 m":e>=1e3?"".concat((e/1e3).toFixed(2)," km"):"".concat(e.toFixed(2)," m")}},{key:"calculateTotalArea",value:function(e){var t=this;return e&&Array.isArray(e)?e.reduce(function(e,n){return e+t.calculateArea(n)},0):0}},{key:"calculateStatistics",value:function(e){var t=this;if(!e||!Array.isArray(e)||0===e.length)return{total:0,average:0,min:0,max:0,count:0};var n=e.map(function(e){return t.calculateArea(e)});return{total:n.reduce(function(e,t){return e+t},0),average:n.reduce(function(e,t){return e+t},0)/n.length,min:Math.min.apply(Math,W(n)),max:Math.max.apply(Math,W(n)),count:n.length}}}],null&&$(e.prototype,null),t&&$(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function X(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ee(o.key),o)}}function ee(e){var t=function(e){if("object"!=Y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Y(t)?t:t+""}var te,ne,oe,re=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"getElement",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&this.elementCache.has(e))return this.elementCache.get(e);var n=document.getElementById(e);return n&&t&&this.elementCache.set(e,n),n}},{key:"getValue",value:function(e){var t=this.getElement(e);return t?t.value:""}},{key:"setValue",value:function(e,t){var n=this.getElement(e);return n?(n.value=t,!0):(console.warn('Elemento com ID "'.concat(e,'" não encontrado')),!1)}},{key:"show",value:function(e){var t=this.getElement(e);t&&(t.style.display="",t.classList.remove("hidden"))}},{key:"hide",value:function(e){var t=this.getElement(e);t&&t.classList.add("hidden")}},{key:"toggle",value:function(e){var t=this.getElement(e);t&&t.classList.toggle("hidden")}},{key:"addClass",value:function(e,t){var n=this.getElement(e);n&&n.classList.add(t)}},{key:"removeClass",value:function(e,t){var n=this.getElement(e);n&&n.classList.remove(t)}},{key:"setText",value:function(e,t){var n=this.getElement(e);n&&(n.textContent=t)}},{key:"setHTML",value:function(e,t){var n=this.getElement(e);n&&(n.innerHTML=t)}},{key:"clearCache",value:function(){this.elementCache.clear()}},{key:"removeFromCache",value:function(e){this.elementCache.delete(e)}},{key:"addEventListener",value:function(e,t,n){var o=this.getElement(e);return o?(o.addEventListener(t,n),!0):(console.warn('Elemento com ID "'.concat(e,'" não encontrado para event listener')),!1)}},{key:"enable",value:function(e){var t=this.getElement(e);t&&(t.disabled=!1)}},{key:"disable",value:function(e){var t=this.getElement(e);t&&(t.disabled=!0)}},{key:"exists",value:function(e){return null!==this.getElement(e)}},{key:"focus",value:function(e){var t=this.getElement(e);t&&"function"==typeof t.focus&&t.focus()}},{key:"createElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=document.createElement(e);return Object.keys(t).forEach(function(e){"class"===e?o.className=t[e]:"style"===e?Object.assign(o.style,t[e]):o.setAttribute(e,t[e])}),n&&(o.innerHTML=n),o}},{key:"clearChildren",value:function(e){var t=this.getElement(e);if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}}],null&&X(e.prototype,null),t&&X(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,le(o.key),o)}}function le(e){var t=function(e){if("object"!=ae(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ae(t)?t:t+""}te=re,ne="elementCache",oe=new Map,(ne=ee(ne))in te?Object.defineProperty(te,ne,{value:oe,enumerable:!0,configurable:!0,writable:!0}):te[ne]=oe;var se=function(){return function(e,t,n){return n&&ie(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},0,[{key:"random",value:function(){var e=Math.floor(Math.random()*this.PALETTE.length);return this.PALETTE[e]}},{key:"fromPalette",value:function(e){var t=e%this.PALETTE.length;return this.PALETTE[t]}},{key:"randomHex",value:function(){return"#"+Math.floor(16777215*Math.random()).toString(16).padStart(6,"0")}},{key:"fromId",value:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);var o=Math.abs(t)%this.PALETTE.length;return this.PALETTE[o]}},{key:"fromStatus",value:function(e){return{disponivel:"#4ECDC4",vendido:"#FF6B6B",reservado:"#FFD54F"}[e]||this.random()}},{key:"darken",value:function(e,t){var n=parseInt(e.replace("#",""),16),o=Math.round(2.55*t),r=(n>>16)-o,a=(n>>8&255)-o,i=(255&n)-o;return"#"+(16777216+65536*(r<255?r<1?0:r:255)+256*(a<255?a<1?0:a:255)+(i<255?i<1?0:i:255)).toString(16).slice(1)}},{key:"lighten",value:function(e,t){var n=parseInt(e.replace("#",""),16),o=Math.round(2.55*t),r=(n>>16)+o,a=(n>>8&255)+o,i=(255&n)+o;return"#"+(16777216+65536*(r<255?r:255)+256*(a<255?a:255)+(i<255?i:255)).toString(16).slice(1)}},{key:"hexToRgb",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},{key:"rgbToHex",value:function(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}},{key:"getContrastColor",value:function(e){var t=this.hexToRgb(e);return t?(.299*t.r+.587*t.g+.114*t.b)/255>.5?"#000000":"#FFFFFF":"#000000"}}])}();function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function ce(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,fe(o.key),o)}}function fe(e){var t=function(e){if("object"!=ue(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ue(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ue(t)?t:t+""}!function(e,t,n){(t=le(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(se,"PALETTE",["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F06292","#AED581","#FFD54F","#4DB6AC","#7986CB","#9575CD","#F06292","#BA68C8","#4FC3F7","#81C784","#DCE775","#FFB74D","#FF8A65","#A1887F","#90A4AE"]);var de=function(){return function(e,t){return t&&ce(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stateManager=t,this.eventBus=n},[{key:"updateDrawingButtons",value:function(e){e?(re.hide("desenhar_lote"),re.show("aplicar_desenho"),re.show("cancelar_desenho"),re.setText("modo_desenho","MODO DESENHO ATIVO")):(re.show("desenhar_lote"),re.hide("aplicar_desenho"),re.hide("cancelar_desenho"),re.setText("modo_desenho",""))}},{key:"renderLotesList",value:function(e){var t=this,n=re.getElement("lista-lotes-container");if(n){if(!e||0===e.length)return this.renderEmptyState(n),this.updateLotesCounter(0),void this.updateTotalArea(0);re.clearChildren("lista-lotes-container"),e.forEach(function(e){var o=t.createLoteElement(e);n.appendChild(o)}),this.updateLotesCounter(e.length),this.updateTotalArea(this.calculateTotalArea(e))}else console.warn("Container de lotes não encontrado")}},{key:"renderEmptyState",value:function(e){re.setHTML("lista-lotes-container",'\n      <div class="no-lotes">\n        <div class="no-lotes-icon">\n          <span class="dashicons dashicons-admin-multisite"></span>\n        </div>\n        <p>Nenhum lote cadastrado ainda.</p>\n        <p class="help-text">Clique em "Desenhar Novo Lote" para começar.</p>\n      </div>\n    ')}},{key:"createLoteElement",value:function(e){var t=re.createElement("div",{class:"lote-item","data-lote-id":e.id}),n="status-".concat(e.status||"disponivel"),o=this.getStatusLabel(e.status),r=Q.formatArea(e.area||0);return t.innerHTML='\n      <h5>\n        <span class="dashicons dashicons-location"></span>\n        '.concat(e.nome||e.id,'\n        <span class="status-badge ').concat(n,'">').concat(o,"</span>\n      </h5>\n      ").concat(e.bloco?"<p><strong>Bloco:</strong> ".concat(e.bloco,"</p>"):"","\n      <p><strong>Área:</strong> ").concat(r,"</p>\n      <p><strong>Vértices:</strong> ").concat(e.coordinates.length,'</p>\n      <div class="lote-actions">\n        <button type="button" class="button button-small lote-action-zoom" data-lote-id="').concat(e.id,'">\n          <span class="dashicons dashicons-visibility"></span> Ver\n        </button>\n        <button type="button" class="button button-small lote-action-edit" data-lote-id="').concat(e.id,'">\n          <span class="dashicons dashicons-edit"></span> Editar\n        </button>\n        <button type="button" class="button button-small lote-action-delete" data-lote-id="').concat(e.id,'">\n          <span class="dashicons dashicons-trash"></span> Excluir\n        </button>\n      </div>\n    '),this.attachLoteActions(t,e.id),t}},{key:"attachLoteActions",value:function(e,t){var n=this,o=e.querySelector(".lote-action-zoom");o&&o.addEventListener("click",function(){n.eventBus.emit("ui:zoom_lote",{loteId:t})});var r=e.querySelector(".lote-action-edit");r&&r.addEventListener("click",function(){n.eventBus.emit("ui:edit_lote",{loteId:t})});var a=e.querySelector(".lote-action-delete");a&&a.addEventListener("click",function(){confirm("Tem certeza que deseja excluir este lote?")&&n.eventBus.emit("ui:delete_lote",{loteId:t})})}},{key:"updateLotesCounter",value:function(e){re.setText("total-lotes",e.toString())}},{key:"updateTotalArea",value:function(e){var t=Q.formatArea(e);re.setText("area-total-value",t)}},{key:"calculateTotalArea",value:function(e){return e.reduce(function(e,t){return e+(t.area||0)},0)}},{key:"getStatusLabel",value:function(e){return{disponivel:"Disponível",vendido:"Vendido",reservado:"Reservado"}[e]||"Disponível"}},{key:"showNotification",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";"error"===t?alert("Erro: "+e):"success"===t?console.log("✓ "+e):console.log(e)}},{key:"toggleLoading",value:function(e){e&&console.log("Loading...")}}])}();function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function ve(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,pe(o.key),o)}}function pe(e){var t=function(e){if("object"!=ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ge(t)?t:t+""}var ye=function(){return function(e,t){return t&&ve(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=null,this.resolveCallback=null,this.rejectCallback=null,this.initialize()},[{key:"initialize",value:function(){var e=this;if(this.modal=document.getElementById("editModal"),this.modal){var t=this.modal.querySelector('button[onclick="saveEditLote()"]');t&&(t.removeAttribute("onclick"),t.addEventListener("click",function(){return e.handleSave()}));var n=this.modal.querySelector('button[onclick="closeEditModal()"]');n&&(n.removeAttribute("onclick"),n.addEventListener("click",function(){return e.handleCancel()})),this.modal.addEventListener("click",function(t){t.target===e.modal&&e.handleCancel()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&e.isOpen()&&e.handleCancel()})}else console.warn("Modal #editModal não encontrado no DOM")}},{key:"openEditModal",value:function(e){var t=this;return new Promise(function(n,o){t.resolveCallback=n,t.rejectCallback=o;var r=document.getElementById("editLoteUnidadeId"),a=document.getElementById("editLoteBloco"),i=document.getElementById("editLoteNome");r&&(r.value=e.id||""),a&&(a.value=e.bloco||""),i&&(i.value=e.nome||""),t.show(),r&&setTimeout(function(){return r.focus()},100)})}},{key:"handleSave",value:function(){var e=document.getElementById("editLoteUnidadeId"),t=document.getElementById("editLoteBloco"),n=document.getElementById("editLoteNome"),o={id:e?e.value.trim():"",bloco:t?t.value.trim():"",nome:n?n.value.trim():""};return o.id?o.bloco?(this.hide(),void(this.resolveCallback&&(this.resolveCallback(o),this.resolveCallback=null,this.rejectCallback=null))):(alert("Bloco é obrigatório"),void(t&&t.focus())):(alert("ID da Unidade é obrigatório"),void(e&&e.focus()))}},{key:"handleCancel",value:function(){this.hide(),this.rejectCallback&&(this.rejectCallback(new Error("Modal cancelado pelo usuário")),this.resolveCallback=null,this.rejectCallback=null)}},{key:"show",value:function(){this.modal&&(this.modal.style.display="block")}},{key:"hide",value:function(){this.modal&&(this.modal.style.display="none")}},{key:"isOpen",value:function(){return this.modal&&"block"===this.modal.style.display}},{key:"clear",value:function(){var e=document.getElementById("editLoteUnidadeId"),t=document.getElementById("editLoteBloco"),n=document.getElementById("editLoteNome");e&&(e.value=""),t&&(t.value=""),n&&(n.value="")}}])}();function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function me(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,be(o.key),o)}}function be(e){var t=function(e){if("object"!=he(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=he(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==he(t)?t:t+""}var we=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id||this.generateId(),this.nome=t.nome||"",this.bloco=t.bloco||"",this.coordinates=t.coordinates||[],this.area=t.area||0,this.color=t.color||"",this.status=t.status||"disponivel",this.observacoes=t.observacoes||"",this.created_at=t.created_at||(new Date).toISOString(),this.updated_at=t.updated_at||(new Date).toISOString()}return function(e,t,n){return t&&me(e.prototype,t),n&&me(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,[{key:"generateId",value:function(){return"lote_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}},{key:"validate",value:function(){var e=[];return this.id||e.push("ID é obrigatório"),(!Array.isArray(this.coordinates)||this.coordinates.length<3)&&e.push("Lote deve ter no mínimo 3 coordenadas"),this.coordinates.length>0&&this.coordinates.forEach(function(t,n){"number"==typeof t.lat&&"number"==typeof t.lng||e.push("Coordenada ".concat(n," inválida"))}),["disponivel","vendido","reservado"].includes(this.status)||e.push("Status inválido: ".concat(this.status)),{valid:0===e.length,errors:e}}},{key:"toJSON",value:function(){return{id:this.id,nome:this.nome,bloco:this.bloco,coordinates:this.coordinates,area:this.area,color:this.color,status:this.status,observacoes:this.observacoes,created_at:this.created_at,updated_at:this.updated_at}}},{key:"update",value:function(e){var t=this;Object.keys(e).forEach(function(n){"id"!==n&&"created_at"!==n&&(t[n]=e[n])}),this.updated_at=(new Date).toISOString()}},{key:"getFullName",value:function(){return this.bloco&&this.nome?"".concat(this.bloco," - ").concat(this.nome):this.nome||this.bloco||this.id}},{key:"getStatusLabel",value:function(){return{disponivel:"Disponível",vendido:"Vendido",reservado:"Reservado"}[this.status]||this.status}},{key:"isAvailable",value:function(){return"disponivel"===this.status}},{key:"markAsSold",value:function(){this.status="vendido",this.updated_at=(new Date).toISOString()}},{key:"markAsReserved",value:function(){this.status="reservado",this.updated_at=(new Date).toISOString()}},{key:"markAsAvailable",value:function(){this.status="disponivel",this.updated_at=(new Date).toISOString()}},{key:"clone",value:function(){return new e(this.toJSON())}}],[{key:"fromJSON",value:function(t){return"string"==typeof t&&(t=JSON.parse(t)),new e(t)}}])}();function ke(e){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ke(e)}function Me(){var e,t,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,o,r,a){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return Se(u,"_invoke",function(n,o,r){var a,l,s,u=0,c=r||[],f=!1,d={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,l=0,s=e,d.n=n,i}};function g(n,o){for(l=n,s=o,t=0;!f&&u&&!r&&t<c.length;t++){var r,a=c[t],g=d.p,v=a[2];n>3?(r=v===o)&&(s=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=g&&((r=n<2&&g<a[1])?(l=0,d.v=o,d.n=a[1]):g<v&&(r=n<3||a[0]>o||o>v)&&(a[4]=n,a[5]=o,d.n=v,l=0))}if(r||n>1)return i;throw f=!0,o}return function(r,c,v){if(u>1)throw TypeError("Generator is already running");for(f&&1===c&&g(c,v),l=c,s=v;(t=l<2?e:s)||!f;){a||(l?l<3?(l>1&&(d.n=-1),g(l,s)):d.n=s:d.v=s);try{if(u=2,a){if(l||(r="next"),t=a[r]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=e}else if((t=(f=d.n<0)?s:n.call(o,d))!==i)break}catch(t){a=e,l=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,r,a),!0),u}var i={};function l(){}function s(){}function u(){}t=Object.getPrototypeOf;var c=[][o]?t(t([][o]())):(Se(t={},o,function(){return this}),t),f=u.prototype=l.prototype=Object.create(c);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Se(e,r,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=u,Se(f,"constructor",u),Se(u,"constructor",s),s.displayName="GeneratorFunction",Se(u,r,"GeneratorFunction"),Se(f),Se(f,r,"Generator"),Se(f,o,function(){return this}),Se(f,"toString",function(){return"[object Generator]"}),(Me=function(){return{w:a,m:d}})()}function Se(e,t,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}Se=function(e,t,n,o){function a(t,n){Se(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Se(e,t,n,o)}function Pe(e,t,n,o,r,a,i){try{var l=e[a](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(o,r)}function Ee(e){return function(){var t=this,n=arguments;return new Promise(function(o,r){var a=e.apply(t,n);function i(e){Pe(a,o,r,i,l,"next",e)}function l(e){Pe(a,o,r,i,l,"throw",e)}i(void 0)})}}function Oe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Le(o.key),o)}}function Le(e){var t=function(e){if("object"!=ke(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ke(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ke(t)?t:t+""}var je=function(){return function(e,t){return t&&Oe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log("🚀 Iniciando TerrenoMapApp..."),this.eventBus=new c,this.stateManager=new i,this.mapManager=null,this.drawingManager=null,this.polygonManager=null,this.geocodeManager=null,this.dataPersistence=null,this.uiManager=null,this.modalManager=null},[{key:"initialize",value:(o=Ee(Me().m(function e(){var t,n,o,r,a,i,l;return Me().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=parseFloat(re.getValue("terreno_latitude"))||-3.7319,n=parseFloat(re.getValue("terreno_longitude"))||-38.5267,o=parseInt(re.getValue("terreno_zoom"))||18,this.mapManager=new h("gmap",this.stateManager,this.eventBus),e.n=1,this.mapManager.initialize(t,n,o);case 1:r=this.mapManager.getMap(),a=this.mapManager.getGeocoder(),this.drawingManager=new k(r,this.stateManager,this.eventBus),this.polygonManager=new E(r,this.stateManager,this.eventBus),this.geocodeManager=new F(a,this.eventBus),this.dataPersistence=new V("terreno_lotes_data",this.stateManager,this.eventBus),this.uiManager=new de(this.stateManager,this.eventBus),this.modalManager=new ye,(i=this.dataPersistence.load()).length>0&&this.polygonManager.loadPolygons(i),this.uiManager.renderLotesList(i),this.setupEventHandlers(),this.setupDOMEventHandlers(),console.log("✓ TerrenoMapApp inicializado com sucesso"),console.log("📍 ".concat(i.length," lote(s) carregado(s)")),e.n=3;break;case 2:e.p=2,l=e.v,console.error("❌ Erro ao inicializar TerrenoMapApp:",l),alert("Erro ao inicializar o mapa. Verifique se a chave da API do Google Maps está configurada corretamente.");case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return o.apply(this,arguments)})},{key:"setupEventHandlers",value:function(){var e=this;this.eventBus.on("drawing:completed",function(e){e.polygon,e.coordinates,console.log("Desenho completado, aguardando aplicação...")}),this.eventBus.on("polygon:clicked",function(e){var t=e.lote;console.log("Polígono clicado:",t.nome||t.id)}),this.eventBus.on("ui:zoom_lote",function(t){var n=t.loteId;e.polygonManager.centerOnPolygon(n),e.polygonManager.highlightPolygon(n)}),this.eventBus.on("ui:edit_lote",function(t){var n=t.loteId;e.openEditModal(n)}),this.eventBus.on("ui:delete_lote",function(t){var n=t.loteId;e.deleteLote(n)}),this.eventBus.on("data:saved",function(){console.log("✓ Dados salvos com sucesso")})}},{key:"setupDOMEventHandlers",value:function(){var e=this;re.addEventListener("desenhar_lote","click",function(){e.startDrawing()}),re.addEventListener("aplicar_desenho","click",function(){e.applyDrawing()}),re.addEventListener("cancelar_desenho","click",function(){e.cancelDrawing()}),re.addEventListener("limpar_lotes","click",function(){confirm("Tem certeza que deseja limpar TODOS os lotes? Esta ação não pode ser desfeita.")&&e.clearAllLotes()}),re.addEventListener("toggle_satellite","click",function(){var t="satellite"===e.mapManager.toggleMapType()?"Visualização Roadmap":"Visualização Satélite";re.setText("toggle_satellite",t)}),re.addEventListener("buscar_endereco","click",function(){e.searchAddress()}),this.eventBus.on("map:zoom_changed",function(e){re.setValue("terreno_zoom",e)}),this.eventBus.on("map:center_updated",function(e){var t=e.lat,n=e.lng;re.setValue("terreno_latitude",t.toFixed(7)),re.setValue("terreno_longitude",n.toFixed(7))})}},{key:"startDrawing",value:function(){this.drawingManager.startDrawing(),this.uiManager.updateDrawingButtons(!0)}},{key:"applyDrawing",value:(n=Ee(Me().m(function e(){var t,n,o,r,a,i,l,s,u;return Me().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=this.drawingManager.getCurrentPolygon()){e.n=1;break}return alert("Nenhum polígono desenhado"),e.a(2);case 1:return n=q.pathToArray(t.getPath()),o=Q.calculateAreaFromCoordinates(n),r=se.random(),a="Lote ".concat(this.stateManager.getState("lotesData").length+1),i=new we({coordinates:n,area:o,color:r,nome:a,bloco:""}),e.p=2,e.n=3,this.modalManager.openEditModal(i);case 3:if(l=e.v,s=new we({id:l.id,coordinates:n,area:o,color:r,nome:l.nome||a,bloco:l.bloco}),(u=s.validate()).valid){e.n=4;break}return alert("Lote inválido: "+u.errors.join(", ")),e.a(2);case 4:t.setMap(null),this.dataPersistence.addLote(s.toJSON()),this.polygonManager.createPolygon(s.toJSON()),this.uiManager.renderLotesList(this.stateManager.getState("lotesData")),this.drawingManager.stopDrawing(),this.uiManager.updateDrawingButtons(!1),console.log("✓ Lote criado - ID:",s.id,"| Nome:",s.nome,"| Bloco:",s.bloco),e.n=6;break;case 5:e.p=5,e.v,t.setMap(null),this.drawingManager.stopDrawing(),this.uiManager.updateDrawingButtons(!1),console.log("Criação de lote cancelada");case 6:return e.a(2)}},e,this,[[2,5]])})),function(){return n.apply(this,arguments)})},{key:"cancelDrawing",value:function(){this.drawingManager.cancelDrawing(),this.uiManager.updateDrawingButtons(!1)}},{key:"clearAllLotes",value:function(){this.polygonManager.clearAllPolygons(),this.dataPersistence.clearAll(),this.uiManager.renderLotesList([]),console.log("✓ Todos os lotes foram removidos")}},{key:"deleteLote",value:function(e){this.polygonManager.deletePolygon(e),this.dataPersistence.removeLote(e),this.uiManager.renderLotesList(this.stateManager.getState("lotesData")),console.log("✓ Lote removido:",e)}},{key:"searchAddress",value:(t=Ee(Me().m(function e(){var t,n,o;return Me().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=re.getValue("terreno_endereco")){e.n=1;break}return alert("Digite um endereço para buscar"),e.a(2);case 1:return e.p=1,e.n=2,this.geocodeManager.smartSearch(t);case 2:n=e.v,this.mapManager.updateCenter(n.lat,n.lng),this.mapManager.updateZoom(18),re.setValue("terreno_latitude",n.lat.toFixed(7)),re.setValue("terreno_longitude",n.lng.toFixed(7)),n.address&&re.setValue("terreno_endereco",n.address),console.log("✓ Endereço encontrado:",n.address||t),e.n=4;break;case 3:e.p=3,o=e.v,alert("Erro ao buscar endereço: "+o.message);case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return t.apply(this,arguments)})},{key:"openEditModal",value:(e=Ee(Me().m(function e(t){var n,o,r;return Me().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=this.stateManager.getLote(t)){e.n=1;break}return alert("Lote não encontrado"),e.a(2);case 1:return e.p=1,e.n=2,this.modalManager.openEditModal(n);case 2:(o=e.v).id!==t?(this.polygonManager.deletePolygon(t),this.dataPersistence.removeLote(t),r=new we({id:o.id,coordinates:n.coordinates,area:n.area,color:n.color,nome:o.nome||n.nome,bloco:o.bloco,status:n.status,observacoes:n.observacoes,created_at:n.created_at}),this.dataPersistence.addLote(r.toJSON()),this.polygonManager.createPolygon(r.toJSON()),console.log("✓ Lote recriado com novo ID - Antigo:",t,"| Novo:",o.id)):(this.dataPersistence.updateLote(t,{nome:o.nome||n.nome,bloco:o.bloco||n.bloco}),console.log("✓ Lote atualizado:",t)),this.uiManager.renderLotesList(this.stateManager.getState("lotesData")),e.n=4;break;case 3:e.p=3,e.v,console.log("Edição cancelada");case 4:return e.a(2)}},e,this,[[1,3]])})),function(t){return e.apply(this,arguments)})}]);var e,t,n,o}();jQuery(document).ready(function(){if(0!==jQuery("#gmap").length){var e=new je;e.initialize(),window.TerrenoMapApp=e}else console.log("Elemento #gmap não encontrado, não iniciando TerrenoMapApp")}),window.TerrenoMapApp={}})();
//# sourceMappingURL=terreno-admin.bundle.js.map